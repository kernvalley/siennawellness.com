{"version":3,"file":"index.min.js","sources":["../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/promises.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/trust.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/module.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/utility.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/events.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/abort.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/attrs.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/dom.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/theme-cookie.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/trust-policies.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/data-handlers.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/HTTPException.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/http.js","../https:/unpkg.com/@shgysk8zer0/kazoo@0.0.14/google-analytics.js","consts.js","index.js"],"sourcesContent":["/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { signalAborted } from './abort.js';\nexport const infinitPromise = new Promise(() => {});\n\nexport async function locksSupported() {\n\tif ('locks' in navigator) {\n\t\ttry {\n\t\t\treturn await navigator.locks.request('lock-test', () => true);\n\t\t} catch(err) {\n\t\t\treturn false;\n\t\t}\n\t}\n}\n\nexport function isAsyncFunction(what) {\n\treturn what instanceof Function && what.constructor.name === 'AsyncFunction';\n}\n\nexport function isAsync(what) {\n\treturn isAsyncFunction(what) || what instanceof  Promise;\n}\n\nexport function getDeferred({ signal } = {}) {\n\tconst deferred = {};\n\n\tdeferred.promise = new Promise((resolve, reject) => {\n\t\tdeferred.resolve = resolve;\n\t\tdeferred.reject = reject;\n\t});\n\n\tif (signal instanceof EventTarget && signal.throwIfAborted instanceof Function) {\n\t\tif (signal.aborted) {\n\t\t\tdeferred.reject(signal.reason);\n\t\t} else {\n\t\t\tsignal.addEventListener('abort', ({ target }) => deferred.reject(target.reason), { once: true });\n\t\t}\n\t}\n\n\treturn Object.seal(deferred);\n}\n\nexport async function callAsAsync(callback, args = [], { thisArg = globalThis, signal } = {}) {\n\tconst { promise, resolve, reject } = getDeferred({ signal });\n\n\tif (! (callback instanceof Function)) {\n\t\treject(new TypeError('`callAsAsync` expects callback to be a function'));\n\t} else if (! Array.isArray(args)) {\n\t\treject(new TypeError('`args` must be an array'));\n\t} else if (signal instanceof AbortSignal && signal.aborted) {\n\t\treject(signal.reason);\n\t} else if (isAsyncFunction(callback)) {\n\t\tcallback.call(thisArg, args).then(resolve).catch(reject);\n\t} else {\n\t\tqueueMicrotask(() => {\n\t\t\ttry {\n\t\t\t\tresolve(callback.call(thisArg, args));\n\t\t\t} catch(err) {\n\t\t\t\treject(err);\n\t\t\t}\n\t\t});\n\t}\n\n\treturn await promise;\n}\n\nexport function createDeferredCallback(callback, { signal, thisArg } = {}) {\n\tconst { promise, resolve } = getDeferred({ signal });\n\tconst retPromise = promise.then(() => callAsAsync(callback, [], { signal, thisArg }));\n\n\treturn async () => {\n\t\tresolve();\n\t\treturn await retPromise;\n\t};\n}\n\nexport async function lock(name, callback, {\n\tthisArg = globalThis,\n\targs = [],\n\tmode = 'exclusive',\n\tifAvailable = false,\n\tsteal = false,\n\tallowFallback = true,\n\tsignal,\n} = {}) {\n\tif ((! allowFallback) || await locksSupported()) {\n\t\treturn await navigator.locks.request(name, { mode, ifAvailable, steal, signal }, async lock => {\n\t\t\tif (lock) {\n\t\t\t\treturn await callAsAsync(callback, [lock, ...args], { thisArg, signal });\n\t\t\t}\n\t\t});\n\t} else {\n\t\treturn await callAsAsync(callback, [null, ...args], { signal, thisArg });\n\t}\n}\n\nexport async function onAnimationFrame(callback, {\n\tthisArg = globalThis,\n\targs = [],\n\tsignal,\n} = {}) {\n\tconst { promise, resolve, reject } = getDeferred({ signal });\n\tconst id = requestAnimationFrame(hrts => callAsAsync(callback, [hrts, ...args], { signal, thisArg }).then(resolve, reject));\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => cancelAnimationFrame(id));\n\t}\n\n\treturn await promise;\n}\n\nexport async function onIdle(callback, {\n\ttimeout,\n\tthisArg = globalThis,\n\targs = [],\n\tsignal,\n} = {}) {\n\tconst { promise, resolve, reject } = getDeferred({ signal });\n\tconst id = requestIdleCallback(hrts => callAsAsync(callback, [hrts, ...args], { thisArg, signal }).then(resolve, reject), { timeout });\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => cancelIdleCallback(id));\n\t}\n\n\treturn await promise;\n}\n\nexport async function onTimeout(callback, {\n\ttimeout = 0,\n\tthisArg = globalThis,\n\targs = [],\n\tsignal,\n} = {}) {\n\tconst { resolve, reject, promise } = getDeferred({ signal });\n\n\tif (Number.isSafeInteger(timeout) && timeout >= 0) {\n\t\tconst id = setTimeout(() => {\n\t\t\tcallAsAsync(callback, args, { signal, thisArg }).then(resolve).catch(reject);\n\t\t}, timeout);\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tsignalAborted(signal).finally(() => clearTimeout(id));\n\t\t}\n\t} else {\n\t\treject(new TypeError('`timeout` must be a positive intege'));\n\t}\n\n\treturn await promise;\n}\n\nexport async function sleep(timeout, { signal } = {}) {\n\tconst { resolve, promise } = getDeferred({ signal });\n\tonTimeout(() => resolve(performance.now()), { signal, timeout })\n\t\t.catch(() => resolve(performance.now()));\n\treturn await promise;\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { callOnce } from './utility.js';\n\nexport function setProp(el, prop, val, {\n\tpolicy,\n} = {}) {\n\tswitch(getPropertyType(el.tagName, prop)) {\n\t\tcase 'TrustedScript':\n\t\t\tel[prop] = createScript(val, { policy });\n\t\t\tbreak;\n\n\t\tcase 'TrustedScriptURL':\n\t\t\tel[prop] = createScriptURL(val, { policy });\n\t\t\tbreak;\n\n\t\tcase 'TrustedHTML':\n\t\t\tel[prop] = createHTML(val, { policy });\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tel[prop] = val;\n\t}\n}\n\nexport function setAttr(el, attr, val, {\n\telementNs,\n\tpolicy,\n} = {}) {\n\tswitch(getAttributeType(el.tagName, attr, elementNs)) {\n\t\tcase 'TrustedScriptURL':\n\t\t\tif (typeof elementNs === 'string') {\n\t\t\t\tel.setAttributeNs(elementNs, attr, createScriptURL(val, { policy }));\n\t\t\t} else {\n\t\t\t\tel.setAttribute(attr, createScriptURL(val, { policy }));\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'TrustedScript':\n\t\t\tif (typeof elementNs === 'string') {\n\t\t\t\tel.setAttributeNS(elementNs, attr, createScript(val, { policy }));\n\t\t\t} else {\n\t\t\t\tel.setAttribute(attr, createScript(val, { policy }));\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'TrustedHTML':\n\t\t\tif (typeof elementNs === 'string') {\n\t\t\t\tel.setAttributeNS(elementNs, attr, createHTML(val, { policy }));\n\t\t\t} else {\n\t\t\t\tel.setAttribute(attr, createHTML(val, { policy }));\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tif (typeof elementNs === 'string') {\n\t\t\t\tel.setAttributeNS(elementNs, attr, val);\n\t\t\t} else {\n\t\t\t\tel.setAttribute(attr, val);\n\t\t\t}\n\t}\n}\n\nexport function supported() {\n\treturn 'trustedTypes' in globalThis\n\t\t&& trustedTypes instanceof EventTarget\n\t\t&& trustedTypes.createPolicy instanceof Function;\n}\n\nexport function isTrustPolicy(policy) {\n\tif ('TrustedTypePolicy' in globalThis && policy instanceof TrustedTypePolicy) {\n\t\treturn true;\n\t} else {\n\t\treturn policy != null && policy.createHTML instanceof Function;\n\t}\n}\n\nexport function hasDefaultPolicy() {\n\treturn supported() && isTrustPolicy(trustedTypes.defaultPolicy);\n}\n\nexport function getAttributeType(tagName, attribute, elementNs) {\n\tif (supported()) {\n\t\treturn trustedTypes.getAttributeType(tagName.toLowerCase(), attribute, elementNs);\n\t} else {\n\t\treturn null;\n\t}\n}\n\nexport function getPropertyType(tagName, property) {\n\tif (supported()) {\n\t\treturn trustedTypes.getPropertyType(tagName.toLowerCase(), property);\n\t} else {\n\t\treturn null;\n\t}\n}\n\nexport function isHTML(input) {\n\tif (supported()) {\n\t\treturn trustedTypes.isHTML(input);\n\t} else {\n\t\treturn typeof input === 'string';\n\t}\n}\n\nexport function isScript(input) {\n\tif (supported()) {\n\t\treturn trustedTypes.isScript(input);\n\t} else {\n\t\treturn typeof input === 'string';\n\t}\n}\n\nexport function isScriptURL(input) {\n\tif (supported()) {\n\t\treturn trustedTypes.isScriptURL(input);\n\t} else {\n\t\treturn typeof input === 'string' || input instanceof URL;\n\t}\n}\n\nexport function isTrustedType(input) {\n\tif (supported()) {\n\t\treturn trustedTypes.isHTML(input) || trustedTypes.isScript(input) || trustedTypes.isScriptURL(input);\n\t} else {\n\t\treturn true;\n\t}\n}\n\nexport function createHTML(input, { policy = getDefaultPolicy() } = {}) {\n\tif (isTrustPolicy(policy) && ! isHTML(input)) {\n\t\treturn policy.createHTML(input);\n\t} else {\n\t\treturn input;\n\t}\n}\n\nexport function createScript(input, { policy = getDefaultPolicy() } = {}) {\n\tif (isTrustPolicy(policy) && ! isScript(input)) {\n\t\treturn policy.createScript(input);\n\t} else {\n\t\treturn input;\n\t}\n}\n\nexport function createScriptURL(input, { policy = getDefaultPolicy() } = {}) {\n\tif (isTrustPolicy(policy) && ! isScriptURL(input)) {\n\t\treturn policy.createScriptURL(input);\n\t} else {\n\t\treturn input;\n\t}\n}\n\nexport function createPolicy(name, {\n\tcreateHTML = () => {\n\t\tthrow new TypeError('This policy does not provide `createHTML()`');\n\t},\n\tcreateScript = () => {\n\t\tthrow new TypeError('This policy does not provide `createScript()`');\n\t},\n\tcreateScriptURL = () => {\n\t\tthrow new TypeError('This policy does not provide `createScriptURL()`');\n\t},\n}) {\n\tif (supported()) {\n\t\treturn trustedTypes.createPolicy(name, { createHTML, createScript, createScriptURL });\n\t} else {\n\t\treturn Object.freeze({\n\t\t\tname,\n\t\t\tcreateHTML: (input, ...args) => createHTML(input.toString(), ...args),\n\t\t\tcreateScript: (input, ...args) => createScript(input.toString(), ...args),\n\t\t\tcreateScriptURL: (input, ...args) => createScriptURL(input.toString(), ...args),\n\t\t});\n\t}\n}\n\nexport function getDefaultPolicy() {\n\tif (supported()) {\n\t\treturn trustedTypes.defaultPolicy;\n\t} else {\n\t\treturn null;\n\t}\n}\n\nexport const createHTMLPolicyGetter = (name, cb) => callOnce(() => createPolicy(name, { createHTML: cb }));\n\nexport const createScriptPolicyGetter = (name, cb) => callOnce(() => createPolicy(name, { createScript: cb }));\n\nexport const createScriptURLPolicyGetter = (name, cb) => callOnce(() => createPolicy(name, { createScriptURL: cb }));\n","const maps = new Map();\nconst cache = new Map();\n\nexport const URL_PREFIXES = ['http:', 'https:'];\nexport const PATH_PREFIXES = ['/', './', '../'];\nexport const isString = str => typeof str === 'string';\nexport const isURL = str => isString(str) && URL_PREFIXES.some(pre => str.startsWith(pre));\nexport const isPath = str => isString(str) && PATH_PREFIXES.some(pre => str.startsWith(pre));\nexport const isBare = str => isString(str)\n\t&& ! [...URL_PREFIXES, ...PATH_PREFIXES].some(pre => str.startsWith(pre));\n\nexport function getImportmap() {\n\tif (maps.has(document)) {\n\t\treturn maps.get(document);\n\t} else {\n\t\tconst script = document.head.querySelector('script[type=\"importmap\"]');\n\n\t\tif (script instanceof HTMLScriptElement) {\n\t\t\tconst { imports = {}, scope = {} } = JSON.parse(script.textContent);\n\t\t\treturn { imports, scope };\n\t\t} else {\n\t\t\treturn { imports: {}, scope: {} };\n\t\t}\n\t}\n}\n\nexport function resolveModule(specifier, { imports } = getImportmap()) {\n\tif (cache.has(specifier)) {\n\t\treturn cache.get(specifier);\n\t} else if (imports.hasOwnProperty(specifier)) {\n\t\treturn imports[specifier];\n\t} else if (specifier.includes('/')) {\n\t\tlet found = false;\n\n\t\tconst longest = Object.keys(imports)\n\t\t\t.filter(spec => spec.endsWith('/'))\n\t\t\t.reduce((match, spec) => {\n\t\t\t\tif (! found && specifier.startsWith(spec)) {\n\t\t\t\t\tfound = true;\n\t\t\t\t\treturn spec;\n\t\t\t\t} else if (found && spec.length > match && specifier.startsWith(spec)) {\n\t\t\t\t\treturn spec;\n\t\t\t\t} else {\n\t\t\t\t\treturn match;\n\t\t\t\t}\n\t\t\t}, null);\n\t\tif (! found) {\n\t\t\tthrow new TypeError(`Resolution of specifier “${specifier}” was blocked by a null entry.`);\n\t\t} else if (found) {\n\t\t\tconst resolved = new URL(specifier.replace(longest, imports[longest]), document.baseURI).href;\n\t\t\tcache.set(specifier, resolved);\n\t\t\treturn resolved;\n\t\t}\n\t}\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { randomInt } from './math.js';\nimport { isAsyncFunction, getDeferred } from './promises.js';\nimport { isScriptURL, isTrustPolicy } from './trust.js';\nimport { isBare, resolveModule } from './module.js';\n\nconst funcs = new WeakMap();\n\nexport function isStrictMode() {\n\t// Probably always true\n\treturn typeof this === 'undefined';\n}\n\nexport const autoServiceWorkerRegistration = callOnce(async ({\n\tpolicy = 'trustedTypes' in globalThis ? trustedTypes.defaultPolicy : null,\n} = {}) => {\n\tif ('serviceWorker' in navigator && 'serviceWorker' in document.documentElement.dataset) {\n\t\tconst { serviceWorker, scope = '/', updateViaCache } = document.documentElement.dataset;\n\n\t\ttry {\n\t\t\tif (isTrustPolicy(policy)) {\n\t\t\t\tawait registerServiceWorker(policy.createScriptURL(serviceWorker), { scope, updateViaCache });\n\t\t\t} else {\n\t\t\t\tawait registerServiceWorker(serviceWorker, { scope, updateViaCache });\n\t\t\t}\n\n\t\t\tawait reloadOnUpdate();\n\t\t} catch(err) {\n\t\t\tconsole.error(err);\n\t\t}\n\t}\n});\n\nexport async function reloadOnUpdate() {\n\tif ('serviceWorker' in navigator && 'reloadOnUpdate' in document.documentElement.dataset) {\n\t\tconst reg = await navigator.serviceWorker.ready;\n\n\t\treg.addEventListener('updatefound', async ({ target }) => {\n\t\t\ttarget.update();\n\n\t\t\tconst HTMLNotificationElement = await customElements.whenDefined('html-notification');\n\t\t\tconst notification = new HTMLNotificationElement('Update available', {\n\t\t\t\tbody: 'App updated in background. Would you like to reload to see updates?',\n\t\t\t\trequireInteraction: true,\n\t\t\t\tactions: [{\n\t\t\t\t\ttitle: 'Reload',\n\t\t\t\t\taction: 'reload',\n\t\t\t\t}, {\n\t\t\t\t\ttitle: 'Dismiss',\n\t\t\t\t\taction: 'dismiss',\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\tnotification.addEventListener('notificationclick', ({ target, action }) => {\n\t\t\t\tswitch(action) {\n\t\t\t\t\tcase 'dismiss':\n\t\t\t\t\t\ttarget.close();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'reload':\n\t\t\t\t\t\ttarget.close();\n\t\t\t\t\t\tlocation.reload();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport async function registerServiceWorker(source, {\n\tscope,\n\tpolicy = 'trustedTypes' in globalThis ? trustedTypes.defaultPolicy : null,\n\ttype = 'classic',\n\tupdateViaCache = 'none',\n} = {}) {\n\tconst { resolve, reject, promise } = getDeferred();\n\n\tif (! ('serviceWorker' in navigator && navigator.serviceWorker.register instanceof Function)) {\n\t\treject(new DOMException('Service worker not supported'));\n\t} else if (! (typeof source === 'string' || isScriptURL(source) || source instanceof URL)) {\n\t\treject(new TypeError('Invalid Service worker registration source'));\n\t} else if (! isScriptURL(source) && isTrustPolicy(policy)) {\n\t\tnavigator.serviceWorker.register(\n\t\t\tpolicy.createScriptURL(source),\n\t\t\t{ scope, type, updateViaCache }\n\t\t).then(resolve).catch(reject);\n\t} else {\n\t\tnavigator.serviceWorker.register(source, { scope, type, updateViaCache })\n\t\t\t.then(resolve).catch(reject);\n\t}\n\n\treturn await promise;\n}\n\nexport function getURLResolver({ base = document.baseURI, path = './' } = {}) {\n\tif (isBare(base)) {\n\t\treturn getURLResolver({ base: resolveModule(base), path });\n\t} else {\n\t\tconst url = new URL(path, base);\n\n\t\treturn path => new URL(path, url).href;\n\t}\n}\n\nexport function isObject(thing) {\n\treturn typeof thing === 'object' && ! Object.is(thing, null) && ! Array.isArray(thing);\n}\n\nexport function isNull(val) {\n\treturn Object.is(val, null);\n}\n\nexport function isUndefined(val) {\n\treturn typeof val === 'undefined';\n}\n\nexport function isIterable(thing) {\n\treturn Array.isArray(thing) || (isObject(thing) && thing[Symbol.iterator] instanceof Function);\n}\n\nexport function isNullish(val) {\n\tswitch (typeof val) {\n\t\tcase 'undefined':\n\t\t\treturn true;\n\n\t\tcase 'object':\n\t\t\tif (Object.is(val, null)) {\n\t\t\t\treturn true;\n\t\t\t} else if (Array.isArray(val)) {\n\t\t\t\treturn val.length === 0;\n\t\t\t} else if (val instanceof Date) {\n\t\t\t\treturn Number.isNaN(val.getTime());\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\tcase 'number':\n\t\t\treturn Number.isNaN(val);\n\n\t\tcase 'string':\n\t\t\treturn val.length === 0;\n\n\t\tdefault:\n\t\t\treturn false;\n\t}\n}\n\nexport function getType(thing) {\n\tswitch (typeof thing) {\n\t\tcase 'undefined':\n\t\t\treturn 'Undefined';\n\n\t\tcase 'function':\n\t\t\tif ('prototype' in thing) {\n\t\t\t\treturn getType(thing.prototype);\n\t\t\t} else if ('constructor' in thing) {\n\t\t\t\treturn thing.constructor.name;\n\t\t\t} else {\n\t\t\t\treturn 'Function';\n\t\t\t}\n\n\t\tcase 'object':\n\t\t\tif (Object.is(thing, null)) {\n\t\t\t\treturn 'Null';\n\t\t\t} else if ('constructor' in thing) {\n\t\t\t\treturn thing.constructor.name;\n\t\t\t} else if (Symbol.toStringTag in thing) {\n\t\t\t\treturn thing[Symbol.toStringTag];\n\t\t\t} else if ('prototype' in thing) {\n\t\t\t\treturn  getType(thing.prototype);\n\t\t\t} else {\n\t\t\t\tconsole.log(thing);\n\t\t\t\treturn 'Unknown Object';\n\t\t\t}\n\n\t\tcase 'string':\n\t\t\treturn 'String';\n\n\t\tcase 'number':\n\t\t\treturn Number.isNaN(thing) ? 'NaN' : 'Number';\n\n\t\tcase 'bigint':\n\t\t\treturn 'BigInt';\n\n\t\tcase 'boolean':\n\t\t\treturn 'Boolean';\n\n\t\tcase 'symbol':\n\t\t\treturn 'Symbol';\n\n\t\tdefault:\n\t\t\treturn 'Unknown';\n\t}\n}\n\nexport function isA(thing, expectedType) {\n\tif (typeof expectedType === 'string') {\n\t\treturn getType(thing) === expectedType;\n\t} else if (isObject(expectedType) && 'constructor' in expectedType) {\n\t\treturn isA(thing, expectedType.constructor.name);\n\t} else {\n\t\tthrow new TypeError('Invalid argument for `expectedType`');\n\t}\n}\n\nexport function sameType(thing1, thing2) {\n\treturn isA(thing1, getType(thing2));\n}\n\nexport function deepEquals(thing1, thing2, { depth = 5 } = {}) {\n\tconst type1 = getType(thing1);\n\tconst type2 = getType(thing2);\n\n\tif (! Number.isSafeInteger(depth)) {\n\t\tthrow new TypeError('`depth` must be an integer');\n\t} else if (type1 !== type2) {\n\t\treturn false;\n\t} else if (thing1 === thing2) {\n\t\treturn true;\n\t} else {\n\t\tdepth--;\n\t\tswitch(type1) {\n\t\t\tcase 'NaN':\n\t\t\t\t// Since NaN !== NaN\n\t\t\t\treturn true;\n\n\t\t\tcase 'BigInt':\n\t\t\tcase 'Number':\n\t\t\tcase 'String':\n\t\t\tcase 'Symbol':\n\t\t\tcase 'Boolean':\n\t\t\t\t// Already know not equal\n\t\t\t\treturn false;\n\n\t\t\tcase 'Object':\n\t\t\t\treturn depth < 0 || deepEquals(Object.entries(thing1), Object.entries(thing2), { depth });\n\n\t\t\tcase 'Array':\n\t\t\t\treturn depth < 0 || (\n\t\t\t\t\tthing1.length === thing2.length\n\t\t\t\t\t&& thing1.every((thing, i) => deepEquals(thing, thing2[i], { depth }))\n\t\t\t\t);\n\n\t\t\tcase 'Map':\n\t\t\tcase 'Set':\n\t\t\t\treturn depth < 0 || deepEquals([...thing1], [...thing2], { depth });\n\n\t\t\tcase 'URL':\n\t\t\t\treturn thing1.href === thing2.href;\n\n\t\t\tdefault:\n\t\t\t\tif (thing1 instanceof Node) {\n\t\t\t\t\treturn thing1.isSameNode(thing2);\n\t\t\t\t} else if (Symbol.iterator in thing1) {\n\t\t\t\t\treturn depth < 0 || deepEquals([...thing1], [...thing2], { depth });\n\t\t\t\t} else {\n\t\t\t\t\t// Since already not `===`\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t}\n\t}\n}\n\n/* global define */\nexport function amd(name, factory, requires = {}) {\n\tif (typeof define === 'function' && define.amd) {\n\t\t// AMD. Register as an anonymous module.\n\t\ttry {\n\t\t\tdefine(name, requires, factory);\n\t\t\treturn true;\n\t\t} catch(err) {\n\t\t\tconsole.error(err);\n\t\t\treturn false;\n\t\t}\n\t} else {\n\t\treturn false;\n\t}\n}\n\nexport function errorToEvent(error, type = 'error') {\n\tif (error instanceof Error) {\n\t\tconst { message, name, fileName: filename, lineNumber: lineno, columnNumber: colno } = error;\n\t\treturn new ErrorEvent(type, { error, message: `${name}: ${message}`, filename, lineno, colno });\n\t} else {\n\t\tthrow new TypeError('`errorToEvent()` only accepts Errors');\n\t}\n}\n\nexport function callOnce(callback, thisArg) {\n\tif (callback.once instanceof Function) {\n\t\treturn callback.once(thisArg);\n\t} else {\n\t\treturn function(...args) {\n\t\t\tif (funcs.has(callback)) {\n\t\t\t\treturn funcs.get(callback);\n\t\t\t} else if (isAsyncFunction(callback)) {\n\t\t\t\tconst retVal = callback.apply(thisArg || this, args).catch(err => {\n\t\t\t\t\tfuncs.delete(callback);\n\t\t\t\t\tthrow err;\n\t\t\t\t});\n\n\t\t\t\tfuncs.set(callback, retVal);\n\t\t\t\treturn retVal;\n\t\t\t} else if (callback instanceof Function) {\n\t\t\t\tconst retVal = callback.apply(thisArg || this, args);\n\t\t\t\tfuncs.set(callback, retVal);\n\t\t\t\treturn retVal;\n\t\t\t}\n\t\t};\n\t}\n}\n\nexport function setURLParams(forURL, params) {\n\tconst url = new URL(forURL, document.baseURI);\n\n\tif (params instanceof HTMLFormElement) {\n\t\treturn setURLParams(url, new FormData(params));\n\t} else if (params instanceof FormData) {\n\t\treturn setURLParams(url, Object.fromEntries(params));\n\t} else if (params instanceof URLSearchParams) {\n\t\treturn setURLParams(url, Object.fromEntries(params));\n\t} else if (Array.isArray(params) || typeof params === 'string') {\n\t\treturn setURLParams(url, new URLSearchParams(params));\n\t} else if (isObject(params)) {\n\t\tObject.entries(params).forEach(([k, v]) => {\n\t\t\tif (typeof v === 'string' || (typeof v === 'number' && ! Number.isNaN(v))) {\n\t\t\t\turl.searchParams.set(k, v);\n\t\t\t} else if (typeof v === 'boolean') {\n\t\t\t\tif (v) {\n\t\t\t\t\turl.searchParams.set(k, '');\n\t\t\t\t} else {\n\t\t\t\t\turl.searchParams.delete(k);\n\t\t\t\t}\n\t\t\t} else if (! isNullish(v)) {\n\t\t\t\turl.searchParams.set(k, v.toString());\n\t\t\t}\n\t\t});\n\t}\n\n\treturn url;\n}\n\nexport function setUTMParams(url, {\n\tsource: utm_source,\n\tmedium: utm_medium = 'referral',\n\tcontent: utm_content,\n\tcampaign: utm_campaign,\n\tterm: utm_term,\n} = {}) {\n\tif (isNullish(url)) {\n\t\treturn null;\n\t} else if (! (url instanceof URL)) {\n\t\treturn setUTMParams(new URL(url, document.baseURI), {\n\t\t\tsource: utm_source,\n\t\t\tmedium: utm_medium,\n\t\t\tcontent: utm_content,\n\t\t\tcampaign: utm_campaign,\n\t\t\tterm: utm_term,\n\t\t});\n\t} else if (typeof utm_source !== 'string') {\n\t\treturn url;\n\t} else {\n\t\treturn setURLParams(url, { utm_source, utm_medium, utm_content, utm_campaign, utm_term });\n\t}\n}\n\nexport function debounce(callback, { delay = 17, thisArg } = {}) {\n\tif (! (callback instanceof Function)) {\n\t\tthrow new TypeError('Callback must be a function');\n\t} else if (! Number.isFinite(delay) || delay < 0) {\n\t\tthrow new TypeError('Timeout must be a positive intiger');\n\t} else {\n\t\tlet to;\n\t\treturn function(...args) {\n\t\t\tif (typeof to === 'number') {\n\t\t\t\tclearTimeout(to);\n\t\t\t\tto = null;\n\t\t\t}\n\t\t\tto = setTimeout((...args) => callback.apply(thisArg, args), delay, ...args);\n\t\t};\n\t}\n}\n\nexport function throttle(callback, { delay = 17, thisArg } = {}) {\n\tif (! (callback instanceof Function)) {\n\t\tthrow new TypeError('Callback must be a function');\n\t} else if (! Number.isFinite(delay) || delay < 0) {\n\t\tthrow new TypeError('Timeout must be a positive intiger');\n\t} else {\n\t\tlet to;\n\t\treturn function(...args) {\n\t\t\tif (typeof to !== 'number') {\n\t\t\t\tto = setTimeout(() => to = null, delay);\n\t\t\t\tcallback.apply(thisArg, args);\n\t\t\t}\n\t\t};\n\t}\n}\n\nexport function random(arr) {\n\tif (Array.isArray(arr) && arr.length !== 0) {\n\t\treturn arr[randomInt(0, arr.length)];\n\t}\n}\n\nexport const toSpinalCase = str => str.replace(/[A-Z]/g, (m, i) => i === 0\n\t? m.toLowerCase()\n\t: `-${m.toLowerCase()}`);\n\nexport const toCamelCase = str => str.replace(/-[a-z\\d]/g, m => m.substr(1).toUpperCase());\n\nexport const ucFirst = str => str.substr(0, 1).toUpperCase() + str.substr(1);\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { query, when } from './dom.js';\nimport { signalAborted } from './abort.js';\nimport { getDeferred } from './promises.js';\nimport { debounce as db, throttle } from './utility.js';\n\nexport async function loaded(target, {\n\tsignal: passedSignal,\n\tsuccess = 'load',\n\terror = 'error',\n} = {}) {\n\treturn await new Promise(async (resolve, reject) => {\n\t\tif (passedSignal instanceof AbortSignal && passedSignal.aborted) {\n\t\t\treject(passedSignal.reason);\n\t\t} else if (target instanceof HTMLScriptElement && target.noModule && HTMLScriptElement.supports('module')) {\n\t\t\t/**\n\t\t\t * <script nomodule> will never load\n\t\t\t */\n\t\t\tresolve(target);\n\t\t} else if (target instanceof HTMLLinkElement && target.disabled) {\n\t\t\t/**\n\t\t\t * <link disabled> will never load\n\t\t\t */\n\t\t\tresolve(target);\n\t\t} else if (target instanceof HTMLImageElement && target.loading === 'lazy' && !(target.parentElement instanceof Element)) {\n\t\t\t/**\n\t\t\t * <img loading=\"lazy\"> will not load until appended\n\t\t\t */\n\t\t\tresolve(target);\n\t\t} else if (target instanceof HTMLImageElement && target.decode instanceof Function) {\n\t\t\tawait target.decode();\n\t\t\treturn target;\n\t\t} else {\n\t\t\tconst controller = new AbortController();\n\t\t\tconst signal = passedSignal instanceof AbortSignal ? AbortSignal.any([\n\t\t\t\tpassedSignal,\n\t\t\t\tcontroller.signal,\n\t\t\t]) : passedSignal;\n\n\t\t\tlisten(target, success, ({ target }) => {\n\t\t\t\tresolve(target);\n\t\t\t\tcontroller.abort();\n\t\t\t}, { once: true, signal });\n\n\t\t\tlisten(target, error, ({ target: { tagName, src, href} }) => {\n\t\t\t\tconst error = new Error(`Failed to load <${tagName.toLowerCase()}>`, {\n\t\t\t\t\tcause: new Error(`Request to ${src || href} failed`),\n\t\t\t\t});\n\n\t\t\t\treject(error);\n\t\t\t\tcontroller.abort(error);\n\t\t\t}, { once: true, signal });\n\n\t\t\tif (passedSignal instanceof AbortSignal) {\n\t\t\t\tlisten(passedSignal, 'abort', ({ target: { reason }}) => {\n\t\t\t\t\tif (! controller.signal.aborted) {\n\t\t\t\t\t\treject(reason);\n\t\t\t\t\t\tcontroller.abort(reason);\n\t\t\t\t\t}\n\t\t\t\t}, { once: true, signal: controller.signal });\n\t\t\t}\n\t\t}\n\t});\n}\n\nexport function getEventFeatures() {\n\tconst el = document.createElement('div');\n\tconst eventFeatures = {\n\t\tnativeSignal: 'AbortController' in globalThis && AbortController.prototype.hasOwnProperty('signal'),\n\t\tsignal: false,\n\t\tpassive: false,\n\t\tcapture: false,\n\t\tonce: false,\n\t};\n\n\t// Use of a getter will detect support when properties are read\n\tconst options = {\n\t\tget passive() {\n\t\t\teventFeatures.passive = true;\n\t\t\treturn undefined;\n\t\t},\n\t\tget signal() {\n\t\t\teventFeatures.signal = true;\n\t\t\treturn undefined;\n\t\t},\n\t\tget capture() {\n\t\t\teventFeatures.capture = true;\n\t\t\treturn undefined;\n\t\t},\n\t\tget once() {\n\t\t\teventFeatures.once = true;\n\t\t\treturn undefined;\n\t\t},\n\t};\n\n\ttry {\n\t\tel.addEventListener('click', null, options);\n\t\tel.removeEventListener('click', null, options);\n\t} catch(err) {\n\t\tconsole.error(err);\n\t}\n\n\treturn Object.seal(eventFeatures);\n}\n\nexport const features = getEventFeatures();\n\nexport function addListener(targets, events, callback, { capture, once, passive, signal } = {}) {\n\tif (! Array.isArray(targets)) {\n\t\ttargets = query(targets);\n\t}\n\n\tif (! Array.isArray(events)) {\n\t\tevents = Array.of(events);\n\t}\n\n\ttargets.forEach(target => {\n\t\tevents.forEach(event => listen(target, event, callback, { capture, once, passive, signal }));\n\t});\n}\n\nexport function listen(target, event, callback, { capture, once, passive, signal } = {}) {\n\tif (! (signal instanceof EventTarget && signal.aborted)) {\n\t\ttarget.addEventListener(event, callback, { capture, once, passive, signal });\n\n\t\tif (features.signal === false && signal instanceof EventTarget) {\n\t\t\tsignalAborted(signal).finally(() => target.removeEventListener(event, callback, { capture, once, passive, signal }));\n\t\t}\n\t}\n}\n\nexport async function once(target, event, { capture, passive, signal } = {}) {\n\tconst { resolve, promise } = getDeferred({ signal, reason: new DOMException('Operation aborted') });\n\tlisten(target, event, resolve, { capture, once: true, passive, signal });\n\treturn await promise;\n}\n\nexport function removeListener(targets, events, callback, { capture, once, passive, signal } = {}) {\n\tif (! Array.isArray(targets)) {\n\t\ttargets = query(targets);\n\t}\n\n\tif (! Array.isArray(events)) {\n\t\tevents = Array.of(events);\n\t}\n\n\ttargets.forEach(target => {\n\t\tevents.forEach(event => target.removeEventListener(event, callback, { capture, once, passive, signal }));\n\t});\n}\n\n/**\n * Control the execution rate of callbacks, i.e. for listeners\n * https://davidwalsh.name/function-debounce\n *\n * @param  Callable callback    The callback\n * @param  int      [ms]        Number of milliseconds, defaulting to 1/60th a second\n * @param  bool     [immediate] Trigger function immediately instead of after wait ms\n * @return function             Rate limited function\n */\nexport function debounce(func, wait = 17, immediate = false) {\n\tconsole.warn('debounce() in events.js is deprecated. Please use utility.js instead.');\n\treturn immediate ? throttle(func, { delay: wait }): db(func, { delay: wait });\n}\n\nexport async function whenOnline({ signal } = {}) {\n\tif (navigator.onLine === false) {\n\t\tawait when(window, 'online', { signal });\n\t}\n}\n\nexport async function whenOffline({ signal } = {}) {\n\tif (navigator.onLine === true) {\n\t\tawait when(window, 'offline', { signal });\n\t}\n}\n\nexport async function whenVisible({ signal } = {}) {\n\tif (document.visibilityState === 'hidden') {\n\t\tawait when(document, 'visibilitychange', { signal });\n\t}\n}\n\nexport async function whenHidden({ signal } = {}) {\n\tif (document.visibilityState === 'visible') {\n\t\tawait when(document, 'visibilitychange', { signal });\n\t}\n}\n\nexport async function* yieldEvents(target, event, { capture, passive, signal } = {}) {\n\tconst pending = [];\n\tconst def = {};\n\n\tif (! (signal instanceof AbortSignal)) {\n\t\tthrow new TypeError('`signal` required to be an `AbortSignal`.');\n\t}\n\n\ttarget.addEventListener(event, ev => {\n\t\tif (def.resolve instanceof Function) {\n\t\t\tconst resolve = def.resolve;\n\t\t\tdelete def.resolve;\n\t\t\tresolve(ev);\n\t\t} else {\n\t\t\tpending.push(ev);\n\t\t}\n\t}, { capture, passive, signal });\n\n\twhile (! signal.aborted) {\n\t\twhile (pending.length !== 0 && ! signal.aborted) {\n\t\t\tyield pending.shift();\n\t\t}\n\n\t\tif (! (def.resolve instanceof Function)) {\n\t\t\tconst { resolve, promise, reject } = getDeferred();\n\t\t\tdef.resolve = resolve;\n\t\t\tdef.reject = reject;\n\t\t\tdef.promise = promise;\n\t\t}\n\n\t\tyield await def.promise;\n\t}\n\n\treturn pending;\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { when, beforeUnload, unloaded } from './dom.js';\nimport { getDeferred } from './promises.js';\nimport { listen } from './events.js';\nexport const supported =  'AbortController' in window && AbortController.prototype.hasOwnProperty('signal');\n\nexport function throwIfAborted(signal) {\n\tif (signal instanceof AbortController) {\n\t\tsignal.signal.throwIfAborted();\n\t} else if (signal instanceof AbortSignal) {\n\t\tsignal.throwIfAborted();\n\t}\n}\n\nexport function getBeforeUnloadSignal() {\n\tconst controller = new AbortController();\n\tbeforeUnload().then(() => controller.abort());\n\treturn controller.signal;\n}\n\nexport function getUnloadSignal() {\n\tconst controller = new AbortController();\n\tunloaded().then(() => controller.abort());\n\treturn controller.signal;\n}\n\nexport function isAborted(signal) {\n\tif (signal instanceof AbortController) {\n\t\treturn signal.signal.aborted;\n\t} else {\n\t\treturn signal instanceof AbortSignal && signal.aborted;\n\t}\n}\n\nexport async function signalAborted(signal) {\n\tconst { reject, promise } = getDeferred();\n\n\tif (signal instanceof AbortController) {\n\t\treturn signalAborted(signal.signal);\n\t} else if (! (signal instanceof EventTarget)) {\n\t\treject(new DOMException('Not an AbortSignal'));\n\t} else if (signal.aborted) {\n\t\treject(signal.reason);\n\t} else {\n\t\tsignal.addEventListener('abort', ({ target }) => reject(target.reason),{ once: true });\n\t}\n\n\treturn promise;\n}\n\nexport function abortButtonController(button, { reason } = {}) {\n\tif (! (button instanceof HTMLButtonElement)) {\n\t\tthrow new TypeError('Not a <button>');\n\t}\n\n\tconst controller = new AbortController();\n\tbutton.disabled = false;\n\n\tlisten(button, 'click', () => controller.abort(reason), { signal: controller.signal, once: true });\n\tlisten(controller.signal, 'abort', () => button.disabled = true, { once: true });\n\n\treturn controller;\n}\n\n/**\n * @deprecated\n */\nexport function abortTimeoutController(timeout, { reason } = {}) {\n\tconsole.warn('`abortTimeoutController()` is deprecated. Use `AbortSignal.timeout()` instead.');\n\tconst controller = new AbortController();\n\n\tabortableTimeout(() => controller.abort(reason), timeout, { signal: controller.signal });\n\n\treturn controller;\n}\n\n/**\n * @deprecated\n */\nexport function abortTimeoutSignal(timeout, { reason } = {}) {\n\treturn abortTimeoutController(timeout, { reason }).signal;\n}\n\nexport function abortEventController(what, events, { passive, capture, reason } = {}) {\n\tconst controller = new AbortController();\n\n\twhen(what, events, { signal: controller.signal, capture, passive, once: true }).then(() => {\n\t\tif (! controller.signal.aborted) {\n\t\t\tcontroller.abort(reason);\n\t\t}\n\t});\n\n\treturn controller;\n}\n\nexport function abortableTimeout(callback, ms, { signal } = {}) {\n\tconst id = setTimeout(() => callback(), ms);\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => clearTimeout(id));\n\t}\n\n\treturn id;\n}\n\nexport function abortableInterval(callback, ms, { signal } = {}) {\n\tconst id = setInterval(() => callback(), ms);\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => clearInterval(id));\n\t}\n\n\treturn id;\n}\n\nexport function abortableAnimationFrame(callback, { signal } = {}) {\n\tconst id = requestAnimationFrame(callback);\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => cancelAnimationFrame(id));\n\t}\n\n\treturn id;\n}\n\nexport function abortableIdleCallback(callback, { signal, timeout } = {}) {\n\tconst id = requestIdleCallback(callback);\n\n\tif (signal instanceof AbortSignal) {\n\t\tsignalAborted(signal).finally(() => cancelIdleCallback(id, { timeout }));\n\t}\n\n\treturn id;\n}\n\nexport function signalRaceController(...signals) {\n\tconst controller = new AbortController();\n\tconst signal = anyAbortedSignal(...signals);\n\n\tsignal.addEventListener('abort', ({ target }) => {\n\t\tcontroller.abort(target.reason || new DOMException('Operation aborted.'));\n\t}, { signal: controller.signal });\n\n\treturn controller;\n}\n\nexport function signalAllController(...signals) {\n\tconst controller = new AbortController();\n\n\tPromise.all(signals.map(signal => signalAborted(signal))).finally(() => controller.abort());\n\n\treturn controller;\n}\n\nexport function anyAbortedSignal(...signals) {\n\tif (AbortSignal.any instanceof Function) {\n\t\treturn AbortSignal.any(signals);\n\t} else {\n\t\tconst controller = new AbortController();\n\n\t\tfor (const signal of signals) {\n\t\t\tif (! (signal instanceof AbortSignal)) {\n\t\t\t\tconst err = new TypeError('`signal` is not an `AbortSignal`');\n\t\t\t\tcontroller.abort(err);\n\t\t\t\tthrow err;\n\t\t\t} else if (signal.aborted) {\n\t\t\t\tcontroller.abort(signal.reason || new DOMException('Operation aborted.'));\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tsignal.addEventListener('abort', ({ target }) => {\n\t\t\t\t\tcontroller.abort(target.reason || new DOMException('Operation aborted.'));\n\t\t\t\t}, { signal: controller.signal });\n\t\t\t}\n\t\t}\n\n\t\treturn controller.signal;\n\t}\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { clamp, between } from './math.js';\nimport { isObject, isNullish } from './utility.js';\nimport { toHexColor, parseHexColor } from './color-utils.js';\nimport { setAttr, isScriptURL, isTrustedType } from './trust.js';\nimport { COLOR } from './patterns.js';\n\nexport function getAttrs(el) {\n\tif (typeof el === 'string') {\n\t\treturn getAttrs(document.querySelector(el));\n\t} else if (el instanceof Element) {\n\t\treturn Object.fromEntries([...el.attributes].map(({ name, value }) => [name, value]));\n\t} else {\n\t\tthrow new TypeError(`Expected an element or selector but got a ${typeof el}`);\n\t}\n}\n\nexport function aria(el, props = {}) {\n\tif (! (el instanceof Element)) {\n\t\tthrow new TypeError('`el` must be an Element');\n\t} else {\n\t\tObject.entries(props).forEach(([prop, val]) => {\n\t\t\tif (prop !== 'role') {\n\t\t\t\tprop = `aria-${prop.toLowerCase()}`;\n\t\t\t}\n\n\t\t\tif (isNullish(val)) {\n\t\t\t\tel.removeAttribute(prop);\n\t\t\t} else {\n\t\t\t\tel.setAttribute(prop, val);\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function data(el, props = {}) {\n\tif (! (el instanceof Element)) {\n\t\tthrow new TypeError('el must be an Element');\n\t} if (! isObject(props)) {\n\t\tthrow new TypeError('props must be an object');\n\t} else {\n\t\tObject.entries(props).forEach(([p, v]) => {\n\t\t\tswitch (typeof v) {\n\t\t\t\tcase 'string':\n\t\t\t\tcase 'number':\n\t\t\t\t\tel.dataset[p] = v.toString();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'boolean':\n\t\t\t\t\tif (v) {\n\t\t\t\t\t\tel.dataset[p] = '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete el.dataset[p];\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'undefined':\n\t\t\t\t\tdelete el.dataset[p];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'object':\n\t\t\t\t\tif (Object.is(v, null)) {\n\t\t\t\t\t\tdelete el.dataset[p];\n\t\t\t\t\t} else if (v instanceof Date) {\n\t\t\t\t\t\tel.dataset[p] = v.toISOString();\n\t\t\t\t\t} else if (v instanceof URL) {\n\t\t\t\t\t\tel.dataset[p] = v.href;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tel.dataset[p] = JSON.stringify(v);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new TypeError(`Unable to handle type: ${typeof v}`);\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function css(el, props = {}, { priority } = {}) {\n\tif (! (el instanceof Element)) {\n\t\tthrow new TypeError('el must be an Element');\n\t} if (! isObject(props)) {\n\t\tthrow new TypeError('props must be an object');\n\t} else {\n\t\tObject.entries(props).forEach(([p, v]) => {\n\t\t\tif (typeof v === 'string' || typeof v === 'number') {\n\t\t\t\tel.style.setProperty(p, v, priority);\n\t\t\t} else if (v instanceof URL) {\n\t\t\t\tel.type.setProperty(p, v.href, priority);\n\t\t\t} else if (typeof v === 'object' && ! Object.is(v, null) && v.toString instanceof Function) {\n\t\t\t\tel.style.setProperty(p, v.toString(), priority);\n\t\t\t} else {\n\t\t\t\tel.style.removeProperty(p);\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function attr(el, props = {}, {\n\tnamespace: elementNs = null,\n\tpolicy,\n} = {}) {\n\tif (! (el instanceof Element)) {\n\t\tthrow new TypeError('el must be an Element');\n\t} if (! isObject(props)) {\n\t\tthrow new TypeError('props must be an object');\n\t} else {\n\t\tObject.entries(props).forEach(([p, v]) => {\n\t\t\tif (typeof v === 'string' || typeof v === 'number') {\n\t\t\t\tsetAttr(el, p, v, { policy, elementNs });\n\t\t\t} else if ('trustedTypes' in globalThis && isTrustedType(v)) {\n\t\t\t\tif (v.toString().length === 0) {\n\t\t\t\t\tel.removeAttribute(p);\n\t\t\t\t} else {\n\t\t\t\t\tsetAttr(el, p, v, { policy, elementNs });\n\t\t\t\t}\n\t\t\t} else if (typeof v === 'boolean') {\n\t\t\t\tif (typeof namespace === 'string') {\n\t\t\t\t\tv ? el.setAttributeNS(elementNs, p, '') : el.removeAttributeNS(elementNs, p);\n\t\t\t\t} else {\n\t\t\t\t\tel.toggleAttribute(p, v);\n\t\t\t\t}\n\t\t\t} else if (v instanceof Date) {\n\t\t\t\tsetAttr(el, p, v.toISOString(), { policy, elementNs });\n\t\t\t} else if (v instanceof URL) {\n\t\t\t\tsetAttr(el, p, v.href, { policy, elementNs });\n\t\t\t} else if (typeof v === 'undefined' || v === null) {\n\t\t\t\tif (typeof namespace === 'string') {\n\t\t\t\t\tel.removeAttributeNS(elementNs, p);\n\t\t\t\t} else {\n\t\t\t\t\tel.removeAttribute(p);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsetAttr(el, p, JSON.stringify(v), { policy, elementNs });\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function getBool(el, attr) {\n\treturn el.hasAttribute(attr);\n}\n\nexport function setBool(el, attr, val) {\n\tel.toggleAttribute(attr, val);\n}\n\nexport function getInt(el, attr, {\n\tfallback = NaN,\n\tmin = Number.MIN_SAFE_INTEGER,\n\tmax = Number.MAX_SAFE_INTEGER,\n} = {}) {\n\tif (el.hasAttribute(attr)) {\n\t\tconst val = clamp(min, parseInt(el.getAttribute(attr)), max);\n\t\treturn Number.isNaN(val) ? fallback : val;\n\t} else {\n\t\treturn fallback;\n\t}\n}\n\nexport function setInt(el, attr, val, {\n\tmin = Number.MIN_SAFE_INTEGER,\n\tmax = Number.MAX_SAFE_INTEGER,\n\tpolicy,\n} = {}) {\n\tif (val instanceof Date) {\n\t\tsetAttr(el, attr, val.getTime(), { min, max, policy});\n\t} else if (Number.isInteger(val)) {\n\t\tsetAttr(el, attr, clamp(min, val, max), { policy });\n\t} else if (typeof val === 'string') {\n\t\tsetInt(el, attr, parseInt(val), { min, max });\n\t} else {\n\t\tel.removeAttribute(attr);\n\t}\n}\n\nexport function getFloat(el, attr, {\n\tfallback = NaN,\n\tmin = Number.MIN_SAFE_INTEGER,\n\tmax = Number.MAX_SAFE_INTEGER,\n} = {}) {\n\tif (el.hasAttribute(attr)) {\n\t\tconst val = clamp(min, parseFloat(el.getAttribute(attr)), max);\n\t\treturn Number.isNaN(val) ? fallback : val;\n\t} else {\n\t\treturn fallback;\n\t}\n}\n\nexport function setFloat(el, attr, val, {\n\tmin = Number.MIN_SAFE_INTEGER,\n\tmax = Number.MAX_SAFE_INTEGER,\n\tpolicy,\n} = {}) {\n\tif (typeof val === 'number' && ! Number.isNaN(val)) {\n\t\tsetAttr(el, attr, clamp(min, val, max), { policy });\n\t} else if (typeof val === 'string') {\n\t\tsetFloat(el, attr, parseFloat(val), { min, max });\n\t} else {\n\t\tel.removeAttribute(attr);\n\t}\n}\n\nexport function getString(el, attr, { fallback = null } = {}) {\n\tif (el.hasAttribute(attr)) {\n\t\treturn el.getAttribute(attr) || fallback;\n\t} else {\n\t\treturn fallback;\n\t}\n}\n\nexport function setString(el, attr, val, {\n\tminLength = 1,\n\tmaxLength = Infinity,\n\tpattern   = null,\n\tfallback,\n\tpolicy,\n} = {}) {\n\tif (\n\t\ttypeof val === 'string'\n\t\t&& between(minLength, val.length, maxLength)\n\t\t&& (! (pattern instanceof RegExp) || pattern.test(val))\n\t) {\n\t\tsetAttr(el, attr, val, { policy });\n\t} else if(isTrustedType(val)) {\n\t\tconst str = val.toString();\n\n\t\tif (\n\t\t\tbetween(minLength, str.length, maxLength)\n\t\t\t&& (! (pattern instanceof RegExp) || pattern.test(str))\n\t\t) {\n\t\t\tsetAttr(el, attr, val, { policy });\n\t\t} else {\n\t\t\tel.removeAttribute(attr);\n\t\t}\n\t} else if (typeof fallback === 'string' || isTrustedType(fallback)) {\n\t\tsetString(el, attr, fallback, { pattern, policy, minLength, maxLength });\n\t} else {\n\t\tel.removeAttribute(attr);\n\t}\n}\n\nexport function getURL(el, attr, { base = document.baseURI } = {}) {\n\tif (el.hasAttribute(attr)) {\n\t\treturn new URL(el.getAttribute(attr), base);\n\t} else {\n\t\treturn null;\n\t}\n}\n\nexport function setURL(el, attr, val, {\n\tbase = document.baseURI,\n\trequirePath = false,\n\tpolicy,\n} = {}) {\n\tif ((val instanceof URL) && (! requirePath || val.pathname.length > 1)) {\n\t\tsetAttr(el, attr, val.href, { policy });\n\t} else if (typeof val === 'string' && val.length !== 0) {\n\t\tsetURL(el, attr, new URL(val, base), { requirePath });\n\t} else if (isScriptURL(val)) {\n\t\tconst url = new URL(val.toString(), document.baseURI);\n\n\t\tif (! requirePath || url.pathname.length > 1) {\n\t\t\tsetAttr(el, attr, val, { policy });\n\t\t} else {\n\t\t\tel.removeAttribute(attr);\n\t\t}\n\t} else {\n\t\tel.removeAttribute(attr);\n\t}\n}\n\nexport function getEnum(el, attr, {\n\tallowed  = [],\n\tfallback = undefined,\n}) {\n\tif (! Array.isArray(allowed) || allowed.length === 0) {\n\t\tthrow new TypeError('`allowed` must be a non-empty array.');\n\t} else if (el.hasAttribute(attr)) {\n\t\tconst val = el.getAttribute(attr);\n\t\treturn allowed.includes(val) ? val : fallback;\n\t} else {\n\t\treturn fallback;\n\t}\n}\n\nexport function setEnum(el, attr, val, {\n\tallowed = [],\n\tfallback = undefined,\n}) {\n\tif (! Array.isArray(allowed) || allowed.length === 0) {\n\t\tthrow new TypeError('`allowed` must be a non-empty array.');\n\t} else if (allowed.includes(val)) {\n\t\tsetAttr(el, attr, val);\n\t} else if (! isNullish(fallback)) {\n\t\tsetAttr(el, attr, fallback);\n\t} else {\n\t\tel.removeAttribute(attr);\n\t}\n}\n\nexport function getColor(el, attr, { fallback } = {}) {\n\tconst val = getString(el, attr);\n\treturn typeof val === 'string' && COLOR.test(val) ? val : fallback;\n}\n\nexport function setColor(el, attr, val, { fallback } = {}) {\n\tsetString(el, attr, val, { fallback, minLength: 3, maxLength: 9, pattern: COLOR });\n}\n\nexport function getRGB(el, attr, { fallback = '#000000' } = {}) {\n\tconst { red = 0, green = 0, blue = 0 } = parseHexColor(getColor(el, attr, { fallback }));\n\treturn { red, green, blue };\n}\n\nexport function setRGB(el, attr, { red = 0, green = 0, blue = 0 } = {}) {\n\tsetColor(el, attr, toHexColor({ red, green, blue }));\n}\n\nexport function getRGBA(el, attr, { fallback = '#000000' } = {}) {\n\tconst { red = 0, green = 0, blue = 0, alpha = 1 } = parseHexColor(getColor(el, attr, { fallback }));\n\treturn { red, green, blue, alpha };\n}\n\nexport function setRGBA(el, attr, { red = 0, green = 0, blue = 0, alpha = 1 } = {}) {\n\tsetColor(el, attr, toHexColor({ red, green, blue, alpha }));\n}\n\nexport { setAttr };\n","/**\n * @copyright 2021-2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { signalAborted } from './abort.js';\nimport { addListener, listen } from './events.js';\nimport { getDeferred, isAsync } from './promises.js';\nimport { isHTML, isTrustPolicy } from './trust.js';\nimport { HTML } from './types.js';\nimport { errorToEvent, callOnce, isNullish, isIterable } from './utility.js';\nimport { data as setData, css as setCss, attr as setAttr, aria as setAria } from './attrs.js';\n\nexport const readyStates = ['loading', 'interactive', 'complete'];\n\nexport const readyStateIndex = (state = document.readyState) => readyStates.indexOf(state);\n\nexport const reachedState = state => ! readyStateIndex(document.readyState) > readyStateIndex(state);\n\nexport function query(what, base = document) {\n\tif (Array.isArray(what)) {\n\t\treturn what;\n\t} else if (what instanceof EventTarget) {\n\t\treturn [what];\n\t} else if (typeof what === 'string') {\n\t\tconst matches = Array.from(base.querySelectorAll(what));\n\n\t\tif (base.matches instanceof Function && base.matches(what)) {\n\t\t\tmatches.push(base);\n\t\t}\n\t\treturn matches;\n\t} else if (isIterable(what)) {\n\t\treturn Array.from(what);\n\t} else {\n\t\tthrow new TypeError('Invalid \"what\" given to query()');\n\t}\n}\n\nexport function nth(what, n, { base } = {}) {\n\treturn query(what, base).at(n);\n}\n\nexport function first(what, base) {\n\treturn nth(what, 0, { base });\n}\n\nexport function last(what, base) {\n\treturn nth(what, -1, { base });\n}\n\nexport function each(what, callback, { base } = {}) {\n\tconst items = query(what, base);\n\titems.forEach(callback);\n\treturn items;\n}\n\nexport function map(what, callback, { base } = {}) {\n\treturn query(what, base).map(callback);\n}\n\nexport function some(what, callback, { base } = {}) {\n\treturn query(what, base).some(callback);\n}\n\nexport function every(what, callback, { base } = {}) {\n\treturn query(what, base).every(callback);\n}\n\nexport function find(what, callback, { base } = {}) {\n\treturn query(what, base).find(callback);\n}\n\nexport function filter(what, callback, { base } = {}) {\n\treturn query(what, base).filter(callback);\n}\n\nexport function groupToMap(what, callback, { base } = {}) {\n\treturn query(what, base).groupToMap(callback);\n}\n\nexport function group(what, callback, { base } = {}) {\n\treturn query(what, base).group(callback);\n}\n\nexport function append(parent, ...nodes) {\n\tparent.append(...nodes);\n}\n\nexport function remove(what, { base } = {}) {\n\treturn each(what, item => item.remove(), { base });\n}\n\nexport function meta({ name, itemprop, property, charset, content }) {\n\tconst meta = document.createElement('meta');\n\n\tif (typeof name === 'string') {\n\t\tmeta.name = name;\n\t\tmeta.content = content;\n\t} else if (typeof itemprop === 'string') {\n\t\tmeta.setAttribute('itemprop', itemprop);\n\t\tmeta.content = content;\n\t} else if (typeof property === 'string') {\n\t\tmeta.setAttribute('property', property);\n\t\tmeta.content = content;\n\t} else if (typeof charset === 'string') {\n\t\tmeta.setAttribute('charset', charset);\n\t} else {\n\t\tthrow new Error('Meta must have either name, itemprop, property, or charset given');\n\t}\n\n\treturn meta;\n}\n\nexport function css(what, props = {}, { base, priority } = {}) {\n\treturn each(what, item => setCss(item, props, { priority }), { base });\n}\n\nexport function aria(what, props ={}, { base } = {}) {\n\teach(what, item => setAria(item, props), { base });\n}\n\nexport function data(what, props = {}, { base } = {}) {\n\treturn each(what, item => setData(item, props), { base });\n}\n\nexport function attr(what, props = {}, { base, namespace = null, policy } = {}) {\n\treturn each(what, item => setAttr(item, props, { namespace, policy }), { base });\n}\n\nexport function toggleAttr(what, attrs, { base, force, signal } = {}) {\n\tif (! Array.isArray(attrs)) {\n\t\tattrs = [attrs];\n\t}\n\tconst items = query(what, base);\n\n\tif (! (signal instanceof AbortSignal)) {\n\t\titems.forEach(item => attrs.forEach(attr => item.toggleAttribute(attr, force)));\n\t} else if (signal.aborted) {\n\t\titems.forEach(item => attrs.forEach(attr => item.removeAttribute(attr)));\n\t} else {\n\t\tif (typeof force !== 'boolean') {\n\t\t\tforce = true;\n\t\t}\n\n\t\titems.forEach(item => attrs.forEach(attr => item.toggleAttribute(attr, force)));\n\n\t\tsignal.addEventListener('abort', () => {\n\t\t\titems.forEach(item => attrs.forEach(attr => item.toggleAttribute(attr, !force)));\n\t\t}, { once: true });\n\t}\n\treturn items;\n}\n\nexport function disable(what, { base, value = true } = {}) {\n\treturn each(what, el => el.disabled = value, { base });\n}\n\nexport function enable(what, { base, value = false } = {}) {\n\treturn disable(what, { base, value });\n}\n\nexport function hide(what, { base, value = true } = {}) {\n\treturn each(what, el => el.hidden = value, { base });\n}\n\nexport function unhide(what, { base, value = false } = {}) {\n\treturn hide(what, { base, value });\n}\n\nexport function value(what, value, { base } = {}) {\n\tif (value == null) {\n\t\treturn each(what, el => el.removeAttribute('value'), { base });\n\t} else {\n\t\treturn each(what, el => el.value = value, { base });\n\t}\n}\n\nexport function addClass(what, ...args) {\n\treturn each(what, el => el.classList.add(...args));\n}\n\nexport function removeClass(what, ...args) {\n\treturn each(what, el => el.classList.remove(...args));\n}\n\nexport function toggleClass(what, classes = {}, { base, force } = {}) {\n\treturn each(what, item => {\n\t\tif (typeof classes === 'string') {\n\t\t\treturn item.classList.toggle(classes, force);\n\t\t} else if (Array.isArray(classes)) {\n\t\t\tclasses.forEach(cn => item.classList.toggle(cn, force));\n\t\t} else {\n\t\t\tObject.entries(classes).forEach(([cl, cond]) => {\n\t\t\t\tif (cond instanceof Function) {\n\t\t\t\t\titem.classList.toggle(cl, cond.apply(what, [cl]));\n\t\t\t\t} else if (cond instanceof AbortSignal) {\n\t\t\t\t\tif (cond.aborted) {\n\t\t\t\t\t\titem.classList.remove(cl);\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem.classList.add(cl, true);\n\t\t\t\t\t\tcond.addEventListener('abort', () => {\n\t\t\t\t\t\t\titem.classList.remove(cl);\n\t\t\t\t\t\t}, { once: true });\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\titem.classList.toggle(cl, cond);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, { base });\n}\n\nexport function replaceClass(what, classes = {}, { base } = {}) {\n\tconst entries = Object.entries(classes);\n\n\treturn each(what, item => {\n\t\tentries.forEach(([from, to]) => item.classList.replace(from, to));\n\t}, { base });\n}\n\nexport function text(what, text, { base } = {}) {\n\treturn each(what, el => el.textContent = text, { base });\n}\n\nexport function html(what, text, {\n\tbase,\n\tsanitizer,\n\tpolicy = 'trustedTypes' in globalThis ? globalThis.trustedTypes.defaultPolicy : undefined,\n} = {}) {\n\tif (typeof sanitizer !== 'undefined' && Element.prototype.setHTML instanceof Function) {\n\t\treturn each(what, el => el.setHTML(text, { sanitizer }), { base });\n\t} else if (isHTML(text)) {\n\t\treturn each(what, el => el.innerHTML = text, { base });\n\t} else if (! isNullish(policy) && policy.createHTML instanceof Function) {\n\t\ttext = policy.createHTML(text);\n\t\treturn each(what, el => el.innerHTML = text, { base });\n\t} else {\n\t\treturn each(what, el => el.innerHTML = text, { base });\n\t}\n}\n\nexport function on(what, when, ...args) {\n\t// @TODO: Figure out a way of adding `base` to arguments\n\tconst items = query(what);\n\n\tif (typeof when === 'string') {\n\t\taddListener(items, [when], ...args);\n\t} else if (Array.isArray(when)) {\n\t\taddListener(items, when, ...args);\n\t} else {\n\t\tObject.entries(when).forEach(([ev, cb]) => addListener(items, [ev], cb, ...args));\n\t}\n\n\treturn items;\n}\n\nexport function prevent(what, event = ['submit'], { signal, capture } = {}) {\n\treturn on(what, event, ev => ev.preventDefault(), { signal, capture });\n}\n\nexport function off(what, when, ...args) {\n\treturn each(what, item => {\n\t\tif (typeof when === 'string') {\n\t\t\titem.removeEventListener(when, ...args);\n\t\t} else if (Array.isArray(when)) {\n\t\t\twhen.forEach(e =>  item.removeEventListener(e, ...args));\n\t\t} else {\n\t\t\tObject.entries(when).forEach(([ev, cb]) => item.removeEventListener(ev, cb, ...args));\n\t\t}\n\t});\n}\n\nexport async function when(what, events, { capture, passive, signal, base } = {}) {\n\tconst controller = new AbortController();\n\tconst { promise, resolve, reject } = getDeferred();\n\n\tif (signal instanceof AbortSignal) {\n\t\tif (signal.aborted) {\n\t\t\tcontroller.abort(signal.reason);\n\t\t} else {\n\t\t\taddEventListener([signal], ['abort'], () => {\n\t\t\t\tcontroller.abort(signal.reason);\n\t\t\t\treject(signal.reason);\n\t\t\t}, { once: true, signal: controller.signal });\n\t\t}\n\t}\n\n\tif (controller.signal.aborted) {\n\t\treject(controller.signal.reason);\n\t} else {\n\t\ton(query(what, base), events, event => {\n\t\t\tresolve(event);\n\t\t\tcontroller.abort();\n\t\t}, { capture, passive, signal: controller.signal });\n\t}\n\n\treturn promise;\n}\n\nexport const ready = callOnce(async function ready({ signal } = {}) {\n\tconst { promise, resolve, reject } = getDeferred();\n\n\tif (signal instanceof AbortSignal && signal.aborted) {\n\t\treject(signal.reason || new DOMException('Operation aborted.'));\n\t} else if (readyStateIndex() === 0) {\n\t\tlisten(document, 'DOMContentLoaded', resolve, { signal, once: true, capture: true });\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tsignal.addEventListener('abort',\n\t\t\t\t({ target }) => reject(target.reason || new DOMException('Operation aborted.')),\n\t\t\t\t{ once: true }\n\t\t\t);\n\t\t}\n\t} else {\n\t\tresolve();\n\t}\n\n\treturn promise;\n});\n\nexport async function whenReadyState(state, { signal } = {}) {\n\tconst { resolve, reject, promise } = getDeferred();\n\tconst stateIndex = readyStateIndex(state);\n\n\tif (signal instanceof AbortSignal && signal.aborted) {\n\t\treject(signal.reason || new DOMException('Operation aborted.'));\n\t} else if (stateIndex < 0) {\n\t\treject(new DOMException(`Invalid state: ${state}`));\n\t} else if (stateIndex > readyStateIndex()) {\n\t\tconst controller = new AbortController();\n\t\tlet settled = false;\n\n\t\tcontroller.signal.addEventListener('abort', ({ target }) => {\n\t\t\tif (! settled) {\n\t\t\t\treject(target.reason || new DOMException('Operation aborted.'));\n\t\t\t\tsettled = true;\n\t\t\t}\n\t\t}, { once: true });\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tsignal.addEventListener('abort', ({ target }) => {\n\t\t\t\tcontroller.abort(target.reason);\n\t\t\t}, { once: true, signal: controller.signal });\n\t\t}\n\n\t\tdocument.addEventListener('readystatechange', () => {\n\t\t\tif (document.readyState === state) {\n\t\t\t\tresolve();\n\t\t\t\tsettled = true;\n\t\t\t\tcontroller.abort();\n\t\t\t}\n\t\t}, { signal: controller.signal });\n\t} else {\n\t\tresolve();\n\t}\n\n\treturn promise;\n}\n\nexport const interactive =  callOnce(async function interactive({ signal } = {}) {\n\tawait whenReadyState('interactive', { signal });\n});\n\nexport const complete = callOnce(async function complete({ signal } = {}) {\n\tawait whenReadyState('complete', { signal });\n});\n\nexport const loaded =  callOnce(async function loaded({ signal } = {}) {\n\tconst { promise, resolve, reject } = getDeferred();\n\n\tif (signal instanceof AbortSignal && signal.aborted) {\n\t\treject(signal.reason || new DOMException('Operation aborted.'));\n\t} else if (readyStateIndex() < 2) {\n\t\tlisten(globalThis, 'load', resolve, { signal, once: true, capture: true });\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tsignal.addEventListener('abort',\n\t\t\t\t({ target }) => reject(target.reason || new DOMException('Operation aborted.')),\n\t\t\t\t{ once: true }\n\t\t\t);\n\t\t}\n\t} else {\n\t\tresolve();\n\t}\n\n\treturn promise;\n});\n\nexport const unloaded = callOnce(async function unloaded({ signal } = {}) {\n\tconst { promise, resolve } = getDeferred();\n\tlisten(globalThis, 'unload', resolve, { signal, once: true, capture: true });\n\treturn promise;\n});\n\nexport const beforeUnload = callOnce(async function beforeUnload({ signal } = {}) {\n\tconst { promise, resolve } = getDeferred({ signal });\n\tlisten(globalThis, 'beforeunload', resolve, { signal, once: true, capture: true });\n\treturn promise;\n});\n\nexport const beforeInstallPrompt = callOnce(async function({ signal } = {}) {\n\tconst { promise, resolve, reject } = getDeferred();\n\n\tif (signal instanceof AbortSignal && signal.aborted) {\n\t\treject(signal.reason);\n\t} else if ('onbeforeinstallprompt' in globalThis) {\n\t\tlisten(globalThis, 'beforeinstallprompt', resolve, { once: true, capture: true, signal });\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tlisten(signal, 'abort', ({ reason }) => reject(reason), { once: true });\n\t\t}\n\t}\n\n\treturn await promise;\n});\n\nexport async function whenPageVisible({ signal } = {}) {\n\tconst { promise, resolve } = getDeferred({ signal });\n\n\tif (document.visibilityState === 'visible') {\n\t\tresolve();\n\t} else {\n\t\tlisten(document, 'visibilitychange', () => resolve(), { once: true, signal });\n\t}\n\n\treturn promise;\n}\n\nexport async function whenPageHidden({ signal } = {}) {\n\tconst { promise, resolve } = getDeferred({ signal });\n\n\tif (document.visibilityState === 'hidden') {\n\t\tresolve();\n\t} else {\n\t\tlisten(document, 'visibilitychange', () => resolve(), { once: true, signal });\n\t}\n\n\treturn promise;\n}\n\nexport function parse(text, {\n\ttype = HTML,\n\tasFrag = true,\n\tsanitizer,\n\tpolicy = 'trustedTypes' in globalThis ? globalThis.trustedTypes.defaultPolicy : undefined,\n} = {}) {\n\tconst parser = new DOMParser();\n\n\tif (asFrag) {\n\t\treturn parseAsFragment(text, { sanitizer, policy });\n\t} else if (isTrustPolicy(policy) && ! isHTML(text)) {\n\t\treturn parser.parseFromString(policy.createHTML(text), type);\n\t} else {\n\t\treturn parser.parseFromString(text, type);\n\t}\n}\n\nexport function documentToFragment(doc, { sanitizer } = {}) {\n\tconst clone = doc.cloneNode(true);\n\tconst frag = document.createDocumentFragment();\n\tfrag.append(...clone.head.childNodes, ...clone.body.childNodes);\n\n\treturn typeof sanitizer !== 'undefined' && sanitizer.sanitize instanceof Function\n\t\t? sanitizer.sanitize(frag) : frag;\n}\n\nexport function parseAsFragment(text, {\n\tsanitizer,\n\tpolicy = 'trustedTypes' in globalThis ? globalThis.trustedTypes.defaultPolicy : undefined,\n} = {}) {\n\tconst tmp = document.createElement('template');\n\n\tif (isTrustPolicy(policy) && ! isHTML(text)) {\n\t\ttmp.innerHTML = policy.createHTML(text);\n\t} else {\n\t\ttmp.innerHTML = text;\n\t}\n\n\treturn typeof sanitizer !== 'undefined' && sanitizer.sanitize instanceof Function\n\t\t? sanitizer.sanitize(tmp.content)\n\t\t: tmp.content;\n}\n\nexport function animate(what, keyframes, opts = { duration: 400, base: document.body }) {\n\tif (opts.signal instanceof AbortSignal && opts.signal.aborted) {\n\t\tthrow opts.signal.reason;\n\t} else if (! (Element.prototype.animate instanceof Function)) {\n\t\tthrow new DOMException('Animations not supported');\n\t} else {\n\t\tif (Number.isInteger(opts)) {\n\t\t\topts = { duration: opts };\n\t\t}\n\n\t\tconst animations = query(what, opts.base).map(item => item.animate(keyframes, opts));\n\n\t\tif (opts.signal instanceof AbortSignal) {\n\t\t\topts.signal.addEventListener('abort', () => animations.forEach(anim => anim.cancel()), { once: true });\n\t\t}\n\n\t\tif (opts.resolve instanceof Function) {\n\t\t\tPromise.allSettled(animations.map(anim => anim.finished))\n\t\t\t\t.then(proms => opts.resolve(proms.group(({ status }) => status)));\n\t\t}\n\n\t\treturn animations;\n\t}\n}\n\nexport function intersect(what, callback, { root, rootMargin, signal, threshold } = {}) {\n\tif (signal instanceof AbortSignal && signal.aborted) {\n\t\tthrow signal.reason;\n\t} else if (! ('IntersectionObserver' in globalThis)) {\n\t\tthrow new DOMException('IntersectionObserver not supported');\n\t} else {\n\t\tconst observer = new IntersectionObserver((entries, observer) => {\n\t\t\tentries.forEach((entry, index) => callback.apply(null, [entry, observer, index]));\n\t\t}, { root, rootMargin, threshold });\n\n\t\teach(what, item => observer.observe(item));\n\n\t\tif (signal instanceof AbortSignal) {\n\t\t\tsignalAborted(signal).finally(() => observer.disconnect());\n\t\t}\n\n\t\treturn observer;\n\t}\n}\n\nexport function mutate(what, callback, options = {}) {\n\tif ('MutationObserver' in globalThis) {\n\t\tconst observer = new MutationObserver((records, observer) => {\n\t\t\trecords.forEach((record, index) => callback.apply(null, [record, observer, index]));\n\t\t});\n\n\t\teach(what, item => observer.observe(item, options));\n\n\t\tif (options.signal instanceof AbortSignal) {\n\t\t\tsignalAborted(options.signal).finally(() => observer.disconnect());\n\t\t}\n\n\t\treturn observer;\n\t} else {\n\t\tthrow new Error('MutationObserver not supported');\n\t}\n}\n\nexport function stripComments(node) {\n\tif (! (node instanceof Node)) {\n\t\tthrow new TypeError('Cannot strip comments from non-node');\n\t} else {\n\t\tswitch(node.nodeType) {\n\t\t\tcase Node.ELEMENT_NODE:\n\t\t\tcase Node.DOCUMENT_NODE:\n\t\t\tcase Node.DOCUMENT_FRAGMENT_NODE:\n\t\t\t\tif (node.hasChildNodes()) {\n\t\t\t\t\t[...node.childNodes].forEach(stripComments);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase Node.COMMENT_NODE:\n\t\t\t\tnode.remove();\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport function supportsElement(...tags) {\n\treturn ! tags.some(tag => document.createElement(tag) instanceof HTMLUnknownElement);\n}\n\nexport function createTable(data, { caption, header, footer } = {}) {\n\tconst table = document.createElement('table');\n\tif (Array.isArray(data)) {\n\t\tdata.forEach(row => {\n\t\t\tif (Array.isArray(row)) {\n\t\t\t\tconst tr = table.insertRow();\n\t\t\t\trow.forEach(cell => tr.insertCell().textContent = cell);\n\t\t\t}\n\t\t});\n\t}\n\n\tif (Array.isArray(header)) {\n\t\tconst tHead = table.createTHead();\n\t\tconst row = tHead.insertRow();\n\t\trow.append(...header.map(cell => {\n\t\t\tconst th = document.createElement('th');\n\t\t\tth.scope = 'col';\n\t\t\tth.textContent = cell;\n\t\t\treturn th;\n\t\t}));\n\t}\n\n\tif (Array.isArray(footer)) {\n\t\tconst tFoot = table.createTFoot();\n\t\tconst row = tFoot.insertRow();\n\t\trow.append(...footer.map(cell => {\n\t\t\tconst th = document.createElement('th');\n\t\t\tth.textContent = cell;\n\t\t\treturn th;\n\t\t}));\n\t}\n\n\tif (typeof caption === 'string') {\n\t\ttable.createCaption().textContent = caption;\n\t}\n\n\treturn table;\n}\n\nexport { addListener, isAsync, errorToEvent };\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { data, attr, ready, query } from './dom.js';\n\nconst COOKIE_NAME   = 'theme';\nconst THEMES        = ['light', 'dark', 'auto'];\nconst DEFAULT_THEME = 'auto';\nconst EVENT         = 'themechange';\n\nif ('cookieStore' in globalThis && globalThis.cookieStore.get instanceof Function) {\n\tPromise.all([\n\t\tcookieStore.get({ name: COOKIE_NAME }),\n\t\tready(),\n\t]).then(([cookie]) => {\n\t\tconst $data = query(':root, [data-theme=\"auto\"]');\n\t\tconst $attr = query('[theme=\"auto\"]');\n\n\t\tconst setTheme = ({ name, value: theme = DEFAULT_THEME } = {}) => {\n\t\t\tif (name === COOKIE_NAME && THEMES.includes(theme)) {\n\t\t\t\tdocument.dispatchEvent(new CustomEvent(EVENT, { detail: { theme }}));\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tdata($data, { theme });\n\t\t\t\t\tattr($attr, { theme });\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tif (cookie && typeof cookie.value === 'string') {\n\t\t\tsetTheme(cookie);\n\t\t}\n\n\t\tglobalThis.cookieStore.addEventListener('change', ({ changed, deleted }) => {\n\t\t\tconst cookie = [...changed, ...deleted].find(({ name }) => name === COOKIE_NAME);\n\n\t\t\tif (cookie) {\n\t\t\t\tsetTheme(cookie);\n\t\t\t}\n\t\t});\n\t});\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { createPolicy } from './trust.js';\nimport { callOnce } from './utility.js';\nconst {\n\tallowElements, allowAttributes, allowComments, blockElements, dropAttributes,\n\tdropElements,\n} = Sanitizer.getDefaultConfiguration();\n\nexport const trustedOrigins = [\n\tlocation.origin,\n\t'https://cdn.kernvalley.us',\n\t'https://unpkg.com',\n];\n\nexport const googleOrigins = [\n\t'https://www.googletagmanager.com',\n\t'https://www.google-analytics.com',\n];\n\nexport const youtubeEmbedOrigins = [\n\t'https://www.youtube.com',\n\t'https://www.youtube-nocookie.com',\n];\n\nexport const youtubeEmbeds = [\n\t'https://www.youtube.com/embed/',\n\t'https://www.youtube-nocookie.com/embed/',\n];\n\nexport function isTrustedScriptOrigin(input) {\n\tconst { origin } = new URL(input, document.baseURI);\n\treturn trustedOrigins.includes(origin);\n}\n\nexport function isGoogleOrigin(input) {\n\tconst { origin } = new URL(input, document.baseURI);\n\treturn googleOrigins.includes(origin);\n}\n\nexport function isYouTubeEmbed(input) {\n\tconst { origin, pathname } = new URL(input, document.baseURI);\n\treturn youtubeEmbedOrigins.includes(origin) && pathname.startsWith('/embed/');\n}\n\nexport function isDisqusEmbedScript(input) {\n\treturn /^https:\\/\\/[\\w-]+\\.disqus\\.com\\/embed\\.js$/.test(input);\n}\n\nexport function isDisqusEmbed(input) {\n\treturn input.startsWith('https://disqus.com/embed/comments/');\n}\n\nfunction createSanitizerCallback(sanitizer = new Sanitizer(Sanitizer.getDefaultConfiguration())) {\n\tif (Sanitizer.prototype.sanitizeFor instanceof Function) {\n\t\treturn input => sanitizer.sanitizeFor('div', input).innerHTML;\n\t} else if (Element.prototype.setHTML instanceof Function) {\n\t\treturn input => {\n\t\t\tconst el = document.createElement('div');\n\t\t\tel.setHTML(input, { sanitizer });\n\t\t\treturn el.innerHTML;\n\t\t};\n\t} else {\n\t\treturn input => input;\n\t}\n}\n\nexport const createEmptyHTML = () => trustedTypes.emptyHTML;\nexport const createEmptyScript = () => trustedTypes.emptyScript;\n\n/**\n * @TODO: Add support for SVG\n */\nexport const sanitizerConfig = {\n\tallowComments,\n\tallowCustomElements: true,\n\tallowElements: [\n\t\t...allowElements, 'krv-ad', 'krv-events', 'leaflet-map', 'leaflet-marker',\n\t\t'youtube-player', 'spotify-player', 'weather-current', 'weather-forecast',\n\t\t'github-user', 'github-repo', 'github-gist', 'wfd-events', 'codepen-embed',\n\t\t'bacon-ipsum', 'facebook-post',\n\t],\n\tallowAttributes: {\n\t\t...allowAttributes,\n\t\t'theme': [\n\t\t\t'krv-ad', 'weather-current', 'weather-forecast', 'wfd-events',\n\t\t\t'codepen-embed',\n\t\t],\n\t\t'loading': [\n\t\t\t...allowAttributes.loading, 'krv-ad', 'weather-current',\n\t\t\t'weather-forecast', 'youtube-player', 'spotify-player',\n\t\t\t'github-user', 'github-repo', 'wfd-events', 'codepen-embed',\n\t\t],\n\t\t'crossorigin': [...allowAttributes.crossorigin, 'leaflet-map'],\n\t\t'source': ['krv-ad', 'krv-events', 'wfd-events'],\n\t\t'medium': ['krv-ad', 'krv-events', 'wfd-events'],\n\t\t'content': ['krv-ad', 'krv-events', 'wfd-events'],\n\t\t'campaign': ['krv-ad', 'krv-events', 'wfd-events'],\n\t\t'term': ['krv-ad', 'krv-events', 'wfd-events'],\n\t\t'count': ['krv-events'],\n\t\t'layout': ['krv-ad'],\n\t\t'center': ['leaflet-map'],\n\t\t'zoom': ['leaflet-map'],\n\t\t'tilesrc': ['leflet-map'],\n\t\t'allowlocate': ['leaflet-map'],\n\t\t'allowfullscreen': ['leaflet-map'],\n\t\t'zoomcontrol': ['leaflet-map'],\n\t\t'minzoom': ['leaflet-map', 'leaflet-marker'],\n\t\t'maxzoom': ['leaflet-map', 'leaflet-marker'],\n\t\t'longitude': ['leaflet-marker'],\n\t\t'latitude': ['leaflet-marker'],\n\t\t'open': [...allowAttributes.open, 'krv-ad'],\n\t\t'appid': ['weather-current', 'weather-forecast'],\n\t\t'postalcode': ['weather-current', 'weather-forecast'],\n\t\t'height': [\n\t\t\t...allowAttributes.height, 'youtube-player', 'github-gist',\n\t\t\t'codepen-embed', 'facebook-post',\n\t\t],\n\t\t'width': [\n\t\t\t...allowAttributes.width, 'youtube-player', 'github-gist',\n\t\t\t'codepen-embed', 'facebook-post',\n\t\t],\n\t\t'large': ['spotify-player'],\n\t\t'uri': ['spotify-player'],\n\t\t'user': [\n\t\t\t'github-repo', 'github-user', 'github-gist', 'codepen-embed',\n\t\t\t'facebook-post',\n\t\t],\n\t\t'bio': ['github-user'],\n\t\t'gist': ['github-gist'],\n\t\t'file': ['github-gist'],\n\t\t'repo': ['github-repo'],\n\t\t'pen': ['codepen-embed'],\n\t\t'tab': ['codepen-embed'],\n\t\t'editable': ['codepen-embed'],\n\t\t'clicktoload': ['codepen-embed'],\n\t\t'lines': ['bacon-ipsum'],\n\t\t'paras': ['bacon-ipsum'],\n\t\t'start-with-lorem': ['bacon-ipsum'],\n\t\t'filler': ['bacon-ipsum'],\n\t\t'post': ['facebook-post'],\n\t\t'showtext': ['facebook-post'],\n\t},\n\tdropAttributes,\n\tblockElements,\n\tdropElements,\n};\n\nexport const getDefaultPolicy = callOnce(() => {\n\tconst sanitizer = new Sanitizer(sanitizerConfig);\n\n\treturn createPolicy('default', {\n\t\tcreateHTML: createSanitizerCallback(sanitizer),\n\t\tcreateScript: createEmptyScript,\n\t\tcreateScriptURL: input => {\n\t\t\tif (isTrustedScriptOrigin(input)) {\n\t\t\t\treturn input;\n\t\t\t} else {\n\t\t\t\tthrow new TypeError(`Disallowed script origin: ${input}`);\n\t\t\t}\n\t\t}\n\t});\n});\n\nexport const getDefaultPolicyWithDisqus = callOnce(() => {\n\tconst sanitizer = new Sanitizer(Sanitizer.getDefaultConfiguration());\n\n\treturn createPolicy('default', {\n\t\tcreateHTML: createSanitizerCallback(sanitizer),\n\t\tcreateScript: createEmptyScript,\n\t\tcreateScriptURL: input => {\n\t\t\tif (isTrustedScriptOrigin(input) || isDisqusEmbed(input)) {\n\t\t\t\treturn input;\n\t\t\t} else {\n\t\t\t\tthrow new TypeError(`Disallowed script origin: ${input}`);\n\t\t\t}\n\t\t}\n\t});\n});\n\nexport const getKRVPolicy = callOnce(() => {\n\tconst sanitizer = new Sanitizer(sanitizerConfig);\n\n\treturn createPolicy('krv', {\n\t\tcreateHTML: createSanitizerCallback(sanitizer),\n\t\tcreateScript: createEmptyScript,\n\t\tcreateScriptURL: input => {\n\t\t\tif (isTrustedScriptOrigin(input)) {\n\t\t\t\treturn input;\n\t\t\t} else {\n\t\t\t\tthrow new TypeError(`Disallowed script origin: ${input}`);\n\t\t\t}\n\t\t}\n\t});\n});\n\nexport const getYouTubePolicy = callOnce(() => createPolicy('youtube#embed', {\n\tcreateScriptURL: input => {\n\t\tif (isYouTubeEmbed(input)) {\n\t\t\treturn input;\n\t\t} else {\n\t\t\tthrow new TypeError(`Invalid YouTube URL: ${input}`);\n\t\t}\n\t}\n}));\n\nexport const getGooglePolicy = callOnce(() => createPolicy('ga#script-url', {\n\tcreateHTML: createEmptyHTML,\n\tcreateScript: createEmptyScript,\n\tcreateScriptURL: input => {\n\t\tif (isGoogleOrigin(input)) {\n\t\t\treturn input;\n\t\t} else {\n\t\t\tthrow new TypeError(`${input} is not a known Google origin.`);\n\t\t}\n\t}\n}));\n\nexport const getDisqusPolicy = callOnce(() => createPolicy('disqus#script-url', {\n\tcreateScriptURL: input => {\n\t\tif (isDisqusEmbedScript(input)) {\n\t\t\treturn input;\n\t\t} else {\n\t\t\tthrow new TypeError(`Invalid Disqus URL: ${input}`);\n\t\t}\n\t}\n}));\n\nexport const getDefaultNoOpPolicy = callOnce(() => createPolicy('default', {}));\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { on, query, each, addClass, removeClass } from './dom.js';\n\nexport function remove() {\n\teach(this.dataset.remove, el => el.remove());\n}\n\nexport function hide() {\n\teach(this.dataset.hide, el => el.hidden = true);\n}\n\nexport function unhide() {\n\teach(this.dataset.unhide, el => el.hidden = false);\n}\n\nexport function disable() {\n\teach(this.dataset.disable, el => el.disabled = true);\n}\n\nexport function enable() {\n\teach(this.dataset.enable, el => el.disabled = false);\n}\n\nexport function fullScreen() {\n\tconst target = document.querySelector(this.dataset.fullScreen);\n\n\tif (target instanceof Element) {\n\t\tif (document.fullscreenElement instanceof Element && document.fullscreenElement.isSameNode(target)) {\n\t\t\tdocument.exitFullscreen();\n\t\t} else {\n\t\t\ttarget.requestFullscreen();\n\t\t}\n\t} else if (document.fullscreenElement instanceof Element) {\n\t\tdocument.exitFullscreen();\n\t}\n}\n\nexport async function cookie() {\n\tconst { cookie: name, value = null, domain = null, maxAge, expires, sameSite = 'Strict', path = '/' } = this.dataset;\n\n\tif (typeof value === 'string') {\n\t\tawait cookieStore.set({ name, value, domain, path,\n\t\t\tmaxAge: typeof maxAge === 'string' ? parseInt(maxAge) : null, sameSite,\n\t\t\texpires: typeof expires === 'string' ? new Date(expires) : null,\n\t\t\tsecure: this.dataset.hasOwnProperty('secure'),\n\t\t});\n\t} else {\n\t\tawait cookieStore.delete({ name, domain, path, secure: this.dataset.hasOwnProperty('secure') });\n\t}\n}\n\nexport function scrollTo() {\n\tconst { scrollTo, behavior = 'smooth', block = 'start', inline = 'nearest' } = this.dataset;\n\tconst target = document.querySelector(scrollTo);\n\n\tif (target instanceof Element) {\n\t\ttarget.scrollIntoView({ behavior, block, inline });\n\t}\n}\n\nexport function show() {\n\tconst target = document.querySelector(this.dataset.show);\n\n\tif (target.show instanceof Function) {\n\t\ttarget.show();\n\t} else {\n\t\ttarget.open = true;\n\t}\n}\n\nexport function open() {\n\teach(this.dataset.open, el => el.open = true);\n}\n\nexport function showModal() {\n\tconst target = document.querySelector(this.dataset.showModal);\n\n\tif (target.showModal instanceof Function) {\n\t\ttarget.showModal();\n\t}\n}\n\nexport function close() {\n\tconst { close, returnValue } = this.dataset;\n\teach(close, el => el.tagName === 'DIALOG' ? el.close(returnValue) : el.open = false);\n}\n\nexport function toggleAttribute() {\n\tconst { selector = ':root', toggleAttribute } = this.dataset;\n\n\tif ('checked' in this) {\n\t\tconst checked = this.checked;\n\t\teach(selector, el => el.toggleAttribute(toggleAttribute, checked));\n\t} else {\n\t\teach(selector, el => el.toggleAttribute(toggleAttribute));\n\t}\n}\n\nexport function copy() {\n\tif (navigator.clipboard && navigator.clipboard.writeText instanceof Function) {\n\t\tnavigator.clipboard.writeText(this.dataset.copy);\n\t}\n}\n\nexport function navigate() {\n\tswitch(this.dataset.navigate) {\n\t\tcase 'back':\n\t\t\thistory.back();\n\t\t\tbreak;\n\n\t\tcase 'forward':\n\t\t\thistory.forward();\n\t\t\tbreak;\n\n\t\tcase 'reload':\n\t\t\tlocation.reload();\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tthrow new DOMException(`Invalid value for data-navigate: ${this.dataset.navigate}`);\n\t}\n}\n\nexport function toggleClass() {\n\tconst { selector = ':root', toggleClass = '' } = this.dataset;\n\n\tif ('checked' in this) {\n\t\tif (this.checked) {\n\t\t\taddClass(selector, ...toggleClass.split(' '));\n\t\t} else {\n\t\t\tremoveClass(selector, ...toggleClass.split(' '));\n\t\t}\n\t} else {\n\t\teach(selector, el => toggleClass.split(' ').forEach(cn => el.classList.toggle(cn)));\n\t}\n}\n\nexport function init({ base = document, capture, once, passive, signal } = {}) {\n\t// NOTE: Need to set keyboard handlers for non-button elements\n\tconst events = ['click'];\n\tconst opts = { capture, passive, once, signal };\n\n\ton(query('[data-remove]', base),           events, remove,          opts);\n\ton(query('[data-hide]', base),             events, hide,            opts);\n\ton(query('[data-unhide]', base),           events, unhide,          opts);\n\ton(query('[data-disable]', base),          events, disable,         opts);\n\ton(query('[data-enable]', base),           events, enable,          opts);\n\ton(query('[data-scroll-to]', base),        events, scrollTo,        opts);\n\ton(query('[data-show]', base),             events, show,            opts);\n\ton(query('[data-open]', base),             events, open,            opts);\n\ton(query('[data-show-modal]', base),       events, showModal,       opts);\n\ton(query('[data-close]', base),            events, close,           opts);\n\ton(query('[data-toggle-attribute]', base), events, toggleAttribute, opts);\n\ton(query('[data-toggle-class]', base),     events, toggleClass,     opts);\n\ton(query('[data-cookie]', base),           events, cookie,          opts);\n\ton(query('[data-navigate]', base),         events, navigate,        opts);\n\ton(query('[data-full-screen]', base),      events, fullScreen,      opts);\n\ton(query('[data-copy]', base),             events, copy,            opts);\n}\n","/**\n * @copyright 2023 Chris Zuber <admin@kernvalley.us>\n */\nconst symbols = { resp: Symbol('resp') };\n\nexport class HTTPException extends Error {\n\tconstructor(resp = Response.error(), { message, cause } = {}) {\n\t\tsuper(\n\t\t\ttypeof message === 'string' ? message :`<${resp.url}> [${resp.status} ${resp.statusText}]`,\n\t\t\t{ cause }\n\t\t);\n\n\t\tObject.defineProperty(this, symbols.resp, {\n\t\t\tvalue: resp,\n\t\t\tconfigurable: false,\n\t\t\twritable: false,\n\t\t\tenumerable: false,\n\t\t});\n\t}\n\n\tasync json() {\n\t\treturn await this[symbols.resp].json();\n\t}\n\n\tasync text() {\n\t\treturn await this[symbols.resp].text();\n\t}\n\n\tget body() {\n\t\treturn this[symbols.resp].body;\n\t}\n\n\tget bodyUsed() {\n\t\treturn this[symbols.resp].bodyUsed;\n\t}\n\n\tget headers() {\n\t\treturn this[symbols.resp].headers;\n\t}\n\n\tget ok() {\n\t\treturn this[symbols.resp].ok;\n\t}\n\n\tget redirected() {\n\t\treturn this[symbols.resp].redirected;\n\t}\n\n\tget status() {\n\t\treturn this[symbols.resp].status;\n\t}\n\n\tget statusText() {\n\t\treturn this[symbols.resp].statusText;\n\t}\n\n\tget type() {\n\t\treturn this[symbols.resp].type;\n\t}\n\n\tget url() {\n\t\treturn this[symbols.resp].url;\n\t}\n\n\ttoJSON() {\n\t\tconst { status, statusText, ok, url, message, type, redirected } = this;\n\t\treturn { status, ok, statusText, url, message, type, redirected };\n\t}\n}\n","/**\n * @copyright 2021-2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { parse } from './dom.js';\nimport { signalAborted } from './abort.js';\nimport { setURLParams, setUTMParams, isObject, isNullish, callOnce } from './utility.js';\nimport { isTrustPolicy } from './trust.js';\nimport { HTTPException } from './HTTPException.js';\nimport * as TYPES from './types.js';\n\nfunction filename(src) {\n\tif (typeof src === 'string') {\n\t\treturn new URL(src, location.origin).pathname.split('/').at(-1);\n\t} else {\n\t\treturn '';\n\t}\n}\n\nfunction getType({ headers }) {\n\tif (headers instanceof Headers && headers.has('Content-Type')) {\n\t\treturn headers.get('Content-Type').split(';')[0];\n\t} else {\n\t\treturn null;\n\t}\n}\n\nfunction handleResponse(resp, { cause, message } = {}) {\n\tif (! (resp instanceof Response)) {\n\t\tthrow new TypeError('Expected a Response object');\n\t} else if (! resp.ok) {\n\t\tthrow new HTTPException(resp, { cause, message });\n\t} else {\n\t\treturn resp;\n\t}\n}\n\nfunction handleError(err) {\n\tif (err instanceof HTTPException) {\n\t\tthrow err;\n\t} else if (err instanceof Error) {\n\t\tthrow new HTTPException(Response.error(), { cause: err, message: err.message });\n\t} else if (typeof err === 'string') {\n\t\tthrow new HTTPException(Response.error(), {\n\t\t\tcause: new DOMException('Unknown network error'),\n\t\t\tmessage: err,\n\t\t});\n\t} else {\n\t\tthrow new HTTPException(Response.error(), {\n\t\t\tcause: new DOMException('Unknown network error'),\n\t\t\tmessage: 'Unknown network error',\n\t\t});\n\t}\n}\n\nexport async function fetch(url, opts = {}) {\n\tif (opts.signal instanceof AbortSignal && opts.signal.aborted) {\n\t\tthrow new HTTPException(Response.error(), {\n\t\t\tcause: opts.signal.reason,\n\t\t\tmessage: opts.signal.reason instanceof Error ? opts.signal.reason.message : opts.signal.reason,\n\t\t});\n\t} else if (opts.signal instanceof AbortSignal && ! ('signal' in Request.prototype)) {\n\t\treturn await Promise.race([\n\t\t\tglobalThis.fetch(url, opts),\n\t\t\tsignalAborted(opts.signal),\n\t\t]).then(resp => handleResponse(resp, { message: opts.errorMessage }), handleError);\n\t} else {\n\t\treturn await globalThis.fetch(url, opts).then(resp => handleResponse(resp, { message: opts.errorMessage }), handleError);\n\t}\n}\n\nexport const getHTTPCSP = callOnce(async function getHTTPCSP() {\n\tconst { ok, headers } = await fetch(location.href, { method: 'HEAD' });\n\n\tif (ok && headers.has('Content-Security-Policy')) {\n\t\tconst directives = headers.get('Content-Security-Policy').trim().split(';').filter(str => str.length !== 0);\n\n\t\treturn Object.fromEntries(directives.map(directive => {\n\t\t\tconst [key, ...rest] = directive.trim().split(' ').filter(part => part.length !== 0);\n\t\t\treturn [key, rest];\n\t\t}));\n\t}\n});\n\nexport const getCSP = callOnce(async function getCSP() {\n\ttry {\n\t\tconst csp = await getHTTPCSP();\n\n\t\tif (typeof csp === 'object' && ! Object.is(csp, null)) {\n\t\t\treturn csp;\n\t\t} else {\n\t\t\treturn getMetaCSP();\n\t\t}\n\t} catch(err) {\n\t\tconsole.error(err);\n\t\treturn getMetaCSP();\n\t}\n});\n\nexport function getMetaCSP() {\n\tconst meta = document.head.querySelector('meta[http-equiv=\"Content-Security-Policy\"][content]');\n\n\tif (meta instanceof HTMLMetaElement) {\n\t\tconst directives = meta.content.trim().split(';').filter(str => str.length !== 0);\n\n\t\treturn Object.fromEntries(directives.map(directive => {\n\t\t\tconst [key, ...rest] = directive.trim().split(' ').filter(part => part.length !== 0);\n\t\t\treturn [key, rest];\n\t\t}));\n\t} else {\n\t\treturn {};\n\t}\n}\n\nexport async function GET(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\tpriority  ='auto',\n\treferrerPolicy = 'no-referrer',\n\theaders = new Headers(),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tif (typeof body !== 'undefined') {\n\t\turl = setURLParams(url, body);\n\t} else if (typeof url === 'string') {\n\t\turl = new URL(url, document.baseURI);\n\t}\n\n\tif (typeof signal === 'undefined' && Number.isInteger(timeout)) {\n\t\tsignal = AbortSignal.timeout(timeout);\n\t} else if (signal instanceof AbortController) {\n\t\tsignal = signal.signal;\n\t}\n\n\treturn await fetch(url, { method: 'GET', mode, credentials, referrerPolicy,\n\t\theaders, cache, redirect, priority, integrity, keepalive, signal, errorMessage });\n}\n\nexport async function POST(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tpriority = 'auto',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\theaders = new Headers(),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tif (typeof body === 'object' && ! (body instanceof FormData)) {\n\t\tif (body instanceof HTMLFormElement) {\n\t\t\tbody = new FormData(body);\n\t\t} else if (body instanceof File) {\n\t\t\tlet file;\n\t\t\t[body, file] = [new FormData(), body];\n\t\t\t// @TODO figure out a default param name for the file\n\t\t\t// @TODO handle multiple files and arrays containing files\n\t\t\tbody.set(file.name, file, file.name);\n\t\t} else {\n\t\t\tbody = JSON.stringify(body);\n\n\t\t\tif (headers instanceof Headers && ! headers.has('Content-Type')) {\n\t\t\t\theaders.set('Content-Type', TYPES.JSON);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (typeof signal === 'undefined' && Number.isInteger(timeout)) {\n\t\tsignal = AbortSignal.timeout(timeout);\n\t} else if (signal instanceof AbortController) {\n\t\tsignal = signal.signal;\n\t}\n\n\treturn await fetch(url, { method: 'POST', body, mode, credentials, referrerPolicy,\n\t\theaders, cache, redirect, priority, integrity, keepalive, signal, errorMessage });\n}\n\nexport async function DELETE(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\tpriority = 'auto',\n\treferrerPolicy = 'no-referrer',\n\theaders = new Headers(),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tif (typeof body !== 'undefined') {\n\t\turl = setURLParams(url, body);\n\t} else if (typeof url === 'string') {\n\t\turl = new URL(url, document.baseURI);\n\t}\n\n\tif (typeof signal === 'undefined' && Number.isInteger(timeout)) {\n\t\tsignal = AbortSignal.timeout(timeout);\n\t} else if (signal instanceof AbortController) {\n\t\tsignal = signal.signal;\n\t}\n\n\treturn await fetch(url, { method: 'DELETE', mode, credentials, referrerPolicy,\n\t\theaders, cache, redirect, priority, integrity, keepalive, signal, errorMessage });\n}\n\nexport async function getHTML(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\tpriority = 'auto',\n\treferrerPolicy = 'no-referrer',\n\theaders = new Headers({ Accept: TYPES.HTML }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\thead = true,\n\tasFrag = true,\n\tsanitizer = undefined,\n\tpolicy,\n\terrorMessage,\n} = {}) {\n\tconst html = await getText(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\tif (isTrustPolicy(policy)) {\n\t\treturn parse(policy.createHTML(html), { asFrag, head });\n\t} else {\n\t\treturn parse(html, { head, asFrag, sanitizer, policy });\n\t}\n}\n\nexport const createTemplateGetter = (...args) => callOnce(() => getHTML(...args));\n\nexport async function getText(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\tpriority = 'auto',\n\treferrerPolicy = 'no-referrer',\n\theaders = new Headers({ Accept: TYPES.TEXT }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tconst resp = await GET(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\treturn await resp.text();\n}\n\nexport async function getJSON(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\tpriority = 'auto',\n\theaders = new Headers({ Accept: TYPES.JSON }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tconst resp = await GET(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\treturn await resp.json();\n}\n\nexport async function getFile(url, {\n\tname = null,\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\tpriority = 'auto',\n\theaders = new Headers(),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tif (typeof name !== 'string') {\n\t\tname = filename(url);\n\t}\n\n\tconst resp = await GET(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\tconst type = getType(resp);\n\treturn new File([await resp.blob()], name, { type });\n}\n\nexport async function submitForm(form) {\n\tif (typeof form === 'string') {\n\t\treturn await submitForm(document.forms[form]);\n\t} else if (form instanceof Event) {\n\t\tform.preventDefault();\n\t\treturn await submitForm(form.target);\n\t} else if (form instanceof HTMLFormElement) {\n\t\tswitch (form.method.toLowerCase()) {\n\t\t\tcase 'get':\n\t\t\t\treturn GET(form.action, { body: new FormData(form) });\n\n\t\t\tcase 'post':\n\t\t\t\treturn POST(form.action, { body: new FormData(form) });\n\n\t\t\tcase 'delete':\n\t\t\t\treturn DELETE(form.action, { body: new FormData(form) });\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unsupported method: ${form.method}`);\n\t\t}\n\t}\n}\n\nexport const getManifest = callOnce(async function getManifest({ timeout, signal } = {}) {\n\tconst resp = await getLink('link[rel=\"manifest\"][href]', { timeout, signal });\n\treturn await resp.json();\n});\n\nexport async function getLink(link, { timeout, signal } = {}) {\n\tif (typeof link === 'string') {\n\t\treturn await getLink(document.querySelector(link, { timeout, signal }));\n\t} else if (! (link instanceof HTMLLinkElement)) {\n\t\tthrow new DOMException('Expected a <link>');\n\t} else if (link.href.length === 0) {\n\t\tthrow new DOMException('Missing `href` on <link>');\n\t} else {\n\t\tconst { href, integrity, type, referrerPolicy, crossOrigin } = link;\n\n\t\tlet credentials;\n\t\tconst mode = typeof crossOrigin === 'string' ? 'cors' : 'no-cors';\n\t\tconst headers = new Headers();\n\n\t\tif (mode === 'cors') {\n\t\t\tcredentials = crossOrigin === 'use-credentials' ? 'include' : 'omit';\n\t\t}\n\n\t\tif (typeof type === 'string') {\n\t\t\theaders.set('Accept', type);\n\t\t}\n\n\t\treturn await GET(href, { mode, credentials, headers, integrity, referrerPolicy, timeout, signal });\n\t}\n}\n\nexport async function postHTML(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\tpriority = 'auto',\n\theaders = new Headers({ Accept: TYPES.HTML }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\thead = true,\n\tasFrag = true,\n\tsanitizer = undefined,\n\tpolicy,\n\terrorMessage,\n} = {}) {\n\tconst html = await postText(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\treturn parse(html, { head, asFrag, sanitizer, policy });\n}\n\nexport async function postJSON(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\tpriority = 'auto',\n\theaders = new Headers({ Accept: TYPES.JSON }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tconst resp = await POST(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\treturn await resp.json();\n}\n\nexport async function postText(url, {\n\tbody = undefined,\n\tmode = 'cors',\n\tcache = 'default',\n\tcredentials = 'omit',\n\tredirect = 'follow',\n\treferrerPolicy = 'no-referrer',\n\tpriority = 'auto',\n\theaders = new Headers({ Accept: TYPES.TEXT }),\n\tintegrity = undefined,\n\tkeepalive = undefined,\n\tsignal = undefined,\n\ttimeout = null,\n\terrorMessage,\n} = {}) {\n\tconst resp = await POST(url, { body, mode, credentials, referrerPolicy, headers,\n\t\tcache, redirect, priority, integrity, keepalive, signal, timeout, errorMessage });\n\n\treturn await resp.text();\n}\n\nexport function navigateTo(to, {\n\tparams = {},\n\tutm: {\n\t\tsource: utm_source,\n\t\tmedium: utm_medium = 'referral',\n\t\tcontent: utm_content,\n\t\tcampaign: utm_campaign,\n\t\tterm: utm_term,\n\t} = {},\n\tallowedOrigins = [],\n\trequirePath = false,\n\torigin = location.origin,\n} = {}) {\n\tconst url = new URL(to, origin);\n\n\tif (! Array.isArray(allowedOrigins)) {\n\t\tthrow new TypeError('`allowedOrigins` must be an array');\n\t} else if (! (url.origin === location.origin || allowedOrigins.includes(url.origin))) {\n\t\tthrow new TypeError(`${url.origin} is not an allowed origin`);\n\t} else if (requirePath && url.pathname.length === 1) {\n\t\tthrow new TypeError('`pathname` is required');\n\t} else if (! isObject(params)) {\n\t\tthrow new TypeError('Expected `params` to be an object');\n\t} else {\n\t\tif (typeof utm_source === 'string') {\n\t\t\tObject.entries({...params, utm_source, utm_medium, utm_content, utm_campaign, utm_term })\n\t\t\t\t.filter(([,v]) => ! isNullish(v))\n\t\t\t\t.forEach(([k, v]) => url.searchParams.set(k, v));\n\t\t} else {\n\t\t\tObject.entries(params)\n\t\t\t\t.filter(([,v]) => ! isNullish(v))\n\t\t\t\t.forEach(([k, v]) => url.searchParams.set(k, v));\n\t\t}\n\n\t\tlocation.href = url.href;\n\t}\n}\n\nexport function postNav(url, data = {}, {\n\ttarget = '_self' ,\n\tenctype = TYPES.FORM_URL_ENCODED,\n\tsignal,\n} = {}) {\n\tif (! (signal instanceof AbortSignal && signal.aborted)) {\n\t\tconst form = document.createElement('form');\n\t\tconst inputs = Object.entries(data).map(([name, value]) => {\n\t\t\tconst input = document.createElement('input');\n\t\t\tinput.name = name;\n\t\t\tinput.type = 'hidden';\n\t\t\tinput.readOnly = true;\n\t\t\tinput.value = value;\n\t\t\treturn input;\n\t\t});\n\n\t\tform.action = url;\n\t\tform.method = 'POST';\n\t\tform.target = target;\n\t\tform.enctype = enctype;\n\t\tform.hidden = true;\n\t\tform.append(...inputs);\n\t\tform.addEventListener('submit', ({ target }) => setTimeout(() => target.remove(), 100), { signal });\n\n\t\trequestAnimationFrame(() => {\n\t\t\tdocument.body.append(form);\n\t\t\tform.submit();\n\t\t});\n\t}\n}\n\nexport { setURLParams, setUTMParams };\n","/**\n * @copyright 2021-2023 Chris Zuber <admin@kernvalley.us>\n */\nimport { loadScript } from './loader.js';\nexport const trustPolicies = ['goog#html'];\n\nif (! Array.isArray(window.dataLayer)) {\n\twindow.dataLayer = [];\n}\n\nexport function ga(...args) {\n\tif (window.ga instanceof Function) {\n\t\treturn window.ga(...args);\n\t}\n}\n\nexport async function ready(timeout = 2000) {\n\tawait new Promise((resolve, reject) => {\n\t\tif (! hasGa()) {\n\t\t\treject(new DOMException('Google Analytics script not loaded'));\n\t\t} else {\n\t\t\tconst id = setTimeout(() => reject(new DOMException('GA ready callback timed-out')), timeout);\n\n\t\t\tga(() => {\n\t\t\t\tclearTimeout(id);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t});\n}\n\nexport function getUTMParams(search = window.location.search) {\n\tconst params = new URLSearchParams(search);\n\treturn  {\n\t\tcampaign: params.get('utm_campaign'),\n\t\tcontent: params.get('utm_content'),\n\t\tmedium: params.get('utm_medium'),\n\t\tsource: params.get('utm_source'),\n\t\tterm: params.get('utm_term'),\n\t};\n}\n\nexport async function create(...args) {\n\tawait ready();\n\treturn ga('create', ...args);\n}\n\nexport async function remove() {\n\tawait ready();\n\treturn ga('remove');\n}\n\nexport async function get(prop, timeout = 150) {\n\treturn await getTracker(timeout).then(tracker => tracker.get(prop));\n}\n\nexport async function getTracker(timeout = 150) {\n\tif (hasGa()) {\n\t\treturn await new Promise(async (resolve, reject) => {\n\t\t\tconst id = setTimeout(() => reject(new DOMException('Timeout obtaining tracker')), timeout);\n\n\t\t\tga(tracker => {\n\t\t\t\tif (typeof tracker !== 'undefined') {\n\t\t\t\t\tclearTimeout(id);\n\t\t\t\t\tresolve(tracker);\n\t\t\t\t} else {\n\t\t\t\t\treject(new DOMException('Unable to obtain GA tracker'));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t} else {\n\t\tnew DOMException('Google Analytics script not loaded');\n\t}\n}\n\nexport async function set(...args) {\n\tawait ready();\n\treturn ga('set', ...args);\n}\n\nexport async function require(...args) {\n\tawait ready();\n\treturn ga('require', ...args);\n}\n\nexport async function provide(...args) {\n\tawait ready();\n\treturn ga('provide', ...args);\n}\n\nexport async function location(url = window.location.href) {\n\treturn set('page', url);\n}\n\nexport async function pageView(page = window.location.pathname) {\n\treturn send({ hitType: 'pageview', page });\n}\n\nexport async function send({\n\teventCategory,\n\teventAction,\n\teventValue,\n\teventLabel,\n\thitType       = 'event',\n\ttransport     = 'beacon',\n} = {}) {\n\tawait new Promise(async(hitCallback, reject) => {\n\t\tif (hasGa()) {\n\t\t\tawait ready();\n\t\t\tga('send', { hitType, eventCategory, eventAction, eventLabel,\n\t\t\t\teventValue, transport, hitCallback });\n\t\t} else {\n\t\t\treject(new Error('ga has not been successfully initialized'));\n\t\t}\n\t});\n}\n\nexport function gtag() {\n\twindow.dataLayer.push(arguments);\n}\n\nexport function hasGa() {\n\treturn window.ga instanceof Function;\n}\n\nexport async function importGa(id, params = {}, { policy } = {}) {\n\tconst url = new URL('https://www.googletagmanager.com/gtag/js');\n\turl.searchParams.set('id', id);\n\tObject.entries(params).forEach(([k, v]) => url.searchParams.set(k, v));\n\n\tawait loadScript(url.href, { crossOrigin: 'use-credentials', policy, }).then(() => {\n\t\tgtag('js', new Date());\n\t\tgtag('config', id);\n\t\tcreate(id, 'auto');\n\t}).catch(console.error);\n\n\treturn { gtag, ga, send, get, set, ready, create, remove, require,\n\t\tlocation, pageView, getTracker, getUTMParams, hasGa };\n}\n\nexport function externalHandler() {\n\tif (hasGa()) {\n\t\tsend({\n\t\t\thitType: 'event',\n\t\t\teventCategory: 'outbound',\n\t\t\teventAction: 'click',\n\t\t\teventLabel: this.href,\n\t\t\ttransport: 'beacon',\n\t\t});\n\t}\n}\n\nexport function telHandler() {\n\tif (hasGa()) {\n\t\tsend({\n\t\t\thitType: 'event',\n\t\t\teventCategory: 'call',\n\t\t\teventLabel: this.href.replace('tel:', '').trim(),\n\t\t\ttransport: 'beacon',\n\t\t});\n\t}\n}\n\nexport function mailtoHandler() {\n\tif (hasGa()) {\n\t\tsend({\n\t\t\thitType: 'event',\n\t\t\teventCategory: 'email',\n\t\t\teventLabel: this.href.replace('mailto:', '').trim(),\n\t\t\ttransport: 'beacon',\n\t\t});\n\t}\n}\n\nexport function geoHandler() {\n\tif (hasGa()) {\n\t\tsend({\n\t\t\thitType: 'event',\n\t\t\teventCategory: 'geo',\n\t\t\teventLabel: this.href.replace('geo:', '').trim(),\n\t\t\ttransport: 'beacon',\n\t\t});\n\t}\n}\n\nexport function genericHandler() {\n\tif (hasGa()) {\n\t\tconst {\n\t\t\thitType = 'event', eventCategory = 'unknown', eventLabel = 'unknown',\n\t\t\ttransport = 'beacon',\n\t\t} = this.dataset;\n\t\tsend({ hitType, eventCategory, eventLabel, transport });\n\t}\n}\n","export const GA = null;\n\nexport const env = (location.hostname === 'localhost' || location.hostname.endsWith('.netlify.live'))\n\t? 'development'\n\t: 'production';\n\nexport const dev = env === 'development';\n\nexport const site = {\n\ttitle: 'Jekyll Template',\n};\n","import '@shgysk8zer0/kazoo/theme-cookie.js';\nimport { getGooglePolicy } from '@shgysk8zer0/kazoo/trust-policies.js';\nimport { ready, toggleClass, css, on } from '@shgysk8zer0/kazoo/dom.js';\nimport { debounce } from '@shgysk8zer0/kazoo/events.js';\nimport { init } from '@shgysk8zer0/kazoo/data-handlers.js';\nimport { importGa, externalHandler, telHandler, mailtoHandler } from '@shgysk8zer0/kazoo/google-analytics.js';\nimport { GA } from './consts.js';\n// import './components.js';\n\nif (! CSS.supports('height', '1dvh')) {\n\tcss([document.documentElement], { '--viewport-height': `${window.innerHeight}px`});\n\n\trequestIdleCallback(() => {\n\t\ton([window], {\n\t\t\tresize: debounce(() => css([document.documentElement], { '--viewport-height': `${window.innerHeight}px`})),\n\t\t\tscroll: () => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tcss('#header', { 'background-position-y': `${-0.5 * scrollY}px` });\n\t\t\t\t});\n\t\t\t}\n\t\t}, { passive: true });\n\t});\n}\n\ntoggleClass([document.documentElement], {\n\t'no-dialog': document.createElement('dialog') instanceof HTMLUnknownElement,\n\t'no-details': document.createElement('details') instanceof HTMLUnknownElement,\n\t'js': true,\n\t'no-js': false,\n});\n\nif (typeof GA === 'string' && GA.length !== 0) {\n\tscheduler.postTask(() => {\n\t\timportGa(GA, {}, { policy: getGooglePolicy() }).then(async ({ ga, hasGa }) => {\n\t\t\tif (hasGa()) {\n\t\t\t\tga('create', GA, 'auto');\n\t\t\t\tga('set', 'transport', 'beacon');\n\t\t\t\tga('send', 'pageview');\n\n\t\t\t\ton('a[rel~=\"external\"]', ['click'], externalHandler, { passive: true, capture: true });\n\t\t\t\ton('a[href^=\"tel:\"]', ['click'], telHandler, { passive: true, capture: true });\n\t\t\t\ton('a[href^=\"mailto:\"]', ['click'], mailtoHandler, { passive: true, capture: true });\n\t\t\t}\n\t\t});\n\t}, { priority: 'background' });\n}\n\nPromise.all([\n\tcustomElements.whenDefined('install-prompt'),\n\tready(),\n]).then(([HTMLInstallPromptElement]) => {\n\tinit();\n\n\tif (location.pathname.startsWith('/contact')) {\n\t\ton('#contact-form', ['cubmit'], submitHandler);\n\t}\n\n\ton('#install-btn', ['click'], () => new HTMLInstallPromptElement().show())\n\t\t.forEach(el => el.hidden = false);\n});\n"],"names":["getDeferred","signal","deferred","promise","Promise","resolve","reject","EventTarget","throwIfAborted","Function","aborted","reason","addEventListener","target","once","Object","seal","setAttr","el","attr","val","elementNs","policy","tagName","attribute","supported","trustedTypes","getAttributeType","toLowerCase","setAttributeNs","createScriptURL","setAttribute","setAttributeNS","createScript","createHTML","globalThis","createPolicy","isTrustPolicy","TrustedTypePolicy","isScriptURL","input","URL","getDefaultPolicy","isHTML","isScript","name","TypeError","freeze","args","toString","defaultPolicy","Map","funcs","WeakMap","async","registerServiceWorker","source","scope","type","updateViaCache","navigator","serviceWorker","register","then","catch","DOMException","isObject","thing","is","Array","isArray","callOnce","callback","thisArg","has","get","what","constructor","retVal","apply","this","err","delete","set","setURLParams","forURL","params","url","document","baseURI","HTMLFormElement","FormData","URLSearchParams","fromEntries","entries","forEach","k","v","Number","isNaN","searchParams","length","Date","getTime","isNullish","documentElement","dataset","ready","update","customElements","whenDefined","body","requireInteraction","actions","title","action","close","location","reload","reloadOnUpdate","console","error","features","createElement","eventFeatures","nativeSignal","AbortController","prototype","hasOwnProperty","passive","capture","options","removeEventListener","getEventFeatures","addListener","targets","events","query","of","event","listen","signalAborted","finally","debounce","func","wait","immediate","warn","delay","isFinite","to","setTimeout","throttle","clearTimeout","db","props","namespace","Element","p","removeAttribute","removeAttributeNS","toggleAttribute","toISOString","href","JSON","stringify","window","readyStates","readyStateIndex","state","readyState","indexOf","base","matches","from","querySelectorAll","push","Symbol","iterator","each","items","css","priority","item","style","setProperty","removeProperty","setCss","data","setData","on","when","ev","cb","AbortSignal","whenReadyState","stateIndex","controller","settled","abort","COOKIE_NAME","THEMES","cookieStore","all","cookie","$data","$attr","setTheme","value","theme","includes","dispatchEvent","CustomEvent","detail","requestAnimationFrame","changed","deleted","find","allowElements","allowAttributes","allowComments","blockElements","dropAttributes","dropElements","Sanitizer","getDefaultConfiguration","trustedOrigins","origin","googleOrigins","youtubeEmbedOrigins","isTrustedScriptOrigin","createSanitizerCallback","sanitizer","sanitizeFor","innerHTML","setHTML","createEmptyHTML","emptyHTML","createEmptyScript","emptyScript","sanitizerConfig","allowCustomElements","loading","crossorigin","medium","content","campaign","term","count","layout","center","zoom","tilesrc","allowlocate","allowfullscreen","zoomcontrol","minzoom","maxzoom","longitude","latitude","open","appid","postalcode","height","width","large","uri","user","bio","gist","file","repo","pen","tab","editable","clicktoload","lines","paras","filler","post","showtext","remove","hide","hidden","unhide","disable","disabled","enable","fullScreen","querySelector","fullscreenElement","isSameNode","exitFullscreen","requestFullscreen","domain","maxAge","expires","sameSite","path","parseInt","secure","scrollTo","behavior","block","inline","scrollIntoView","show","showModal","returnValue","selector","checked","copy","clipboard","writeText","navigate","history","back","forward","toggleClass","classList","add","addClass","split","removeClass","cn","toggle","startsWith","isDisqusEmbed","pathname","isYouTubeEmbed","isGoogleOrigin","test","isDisqusEmbedScript","symbols","resp","HTTPException","Error","Response","message","cause","super","status","statusText","defineProperty","configurable","writable","enumerable","json","text","bodyUsed","headers","ok","redirected","toJSON","handleResponse","handleError","fetch","opts","Request","race","errorMessage","getHTTPCSP","method","directives","trim","filter","str","map","directive","key","rest","part","getMetaCSP","meta","head","HTMLMetaElement","getLink","link","timeout","HTMLLinkElement","integrity","referrerPolicy","crossOrigin","credentials","mode","Headers","cache","redirect","keepalive","isInteger","GET","csp","dataLayer","hostname","endsWith","CSS","supports","innerHeight","requestIdleCallback","resize","scroll","scrollY","classes","force","cl","cond","HTMLUnknownElement","js","HTMLInstallPromptElement","init","submitHandler"],"mappings":"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"}